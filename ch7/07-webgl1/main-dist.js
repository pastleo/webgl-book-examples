(()=>{var ra=Object.defineProperty;var fn=Object.getOwnPropertySymbols;var na=Object.prototype.hasOwnProperty,oa=Object.prototype.propertyIsEnumerable;var mn=(e,t,r)=>t in e?ra(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,Ge=(e,t)=>{for(var r in t||(t={}))na.call(t,r)&&mn(e,r,t[r]);if(fn)for(var r of fn(t))oa.call(t,r)&&mn(e,r,t[r]);return e};var ve=(e,t,r)=>new Promise((n,o)=>{var a=i=>{try{s(r.next(i))}catch(c){o(c)}},l=i=>{try{s(r.throw(i))}catch(c){o(c)}},s=i=>i.done?n(i.value):Promise.resolve(i.value).then(a,l);s((r=r.apply(e,t)).next())});var wr=Float32Array;function Sr(e,t,r){let n=new wr(3);return e&&(n[0]=e),t&&(n[1]=t),r&&(n[2]=r),n}function aa(e,t,r){return r=r||new wr(3),r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r}function ia(e,t,r){return r=r||new wr(3),r[0]=e[0]*t[0],r[1]=e[1]*t[1],r[2]=e[2]*t[2],r}var gn=Float32Array;function sa(e){return e=e||new gn(16),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ca(e,t){t=t||new gn(16);let r=e[0*4+0],n=e[0*4+1],o=e[0*4+2],a=e[0*4+3],l=e[1*4+0],s=e[1*4+1],i=e[1*4+2],c=e[1*4+3],u=e[2*4+0],h=e[2*4+1],m=e[2*4+2],x=e[2*4+3],f=e[3*4+0],p=e[3*4+1],_=e[3*4+2],d=e[3*4+3],E=m*d,T=_*x,b=i*d,A=_*c,g=i*x,S=m*c,I=o*d,w=_*a,B=o*x,C=m*a,V=o*c,U=i*a,q=u*p,k=f*h,G=l*p,Y=f*s,X=l*h,j=u*s,H=r*p,W=f*n,J=r*h,ee=u*n,te=r*s,ne=l*n,ce=E*s+A*h+g*p-(T*s+b*h+S*p),le=T*n+I*h+C*p-(E*n+w*h+B*p),ue=b*n+w*s+V*p-(A*n+I*s+U*p),D=S*n+B*s+U*h-(g*n+C*s+V*h),O=1/(r*ce+l*le+u*ue+f*D);return t[0]=O*ce,t[1]=O*le,t[2]=O*ue,t[3]=O*D,t[4]=O*(T*l+b*u+S*f-(E*l+A*u+g*f)),t[5]=O*(E*r+w*u+B*f-(T*r+I*u+C*f)),t[6]=O*(A*r+I*l+U*f-(b*r+w*l+V*f)),t[7]=O*(g*r+C*l+V*u-(S*r+B*l+U*u)),t[8]=O*(q*c+Y*x+X*d-(k*c+G*x+j*d)),t[9]=O*(k*a+H*x+ee*d-(q*a+W*x+J*d)),t[10]=O*(G*a+W*c+te*d-(Y*a+H*c+ne*d)),t[11]=O*(j*a+J*c+ne*x-(X*a+ee*c+te*x)),t[12]=O*(G*m+j*_+k*i-(X*_+q*i+Y*m)),t[13]=O*(J*_+q*o+W*m-(H*m+ee*_+k*o)),t[14]=O*(H*i+ne*_+Y*o-(te*_+G*o+W*i)),t[15]=O*(te*m+X*o+ee*i-(J*i+ne*m+j*o)),t}function la(e,t,r){r=r||Sr();let n=t[0],o=t[1],a=t[2],l=n*e[0*4+3]+o*e[1*4+3]+a*e[2*4+3]+e[3*4+3];return r[0]=(n*e[0*4+0]+o*e[1*4+0]+a*e[2*4+0]+e[3*4+0])/l,r[1]=(n*e[0*4+1]+o*e[1*4+1]+a*e[2*4+1]+e[3*4+1])/l,r[2]=(n*e[0*4+2]+o*e[1*4+2]+a*e[2*4+2]+e[3*4+2])/l,r}function ua(e,t,r){r=r||Sr();let n=t[0],o=t[1],a=t[2];return r[0]=n*e[0*4+0]+o*e[1*4+0]+a*e[2*4+0],r[1]=n*e[0*4+1]+o*e[1*4+1]+a*e[2*4+1],r[2]=n*e[0*4+2]+o*e[1*4+2]+a*e[2*4+2],r}var Fr=5120,$e=5121,Ir=5122,Rr=5123,Pr=5124,Br=5125,Cr=5126,fa=32819,ma=32820,ha=33635,xa=5131,pa=33640,_a=35899,da=35902,ya=36269,Ea=34042,Mn={};{let e=Mn;e[Fr]=Int8Array,e[$e]=Uint8Array,e[Ir]=Int16Array,e[Rr]=Uint16Array,e[Pr]=Int32Array,e[Br]=Uint32Array,e[Cr]=Float32Array,e[fa]=Uint16Array,e[ma]=Uint16Array,e[ha]=Uint16Array,e[xa]=Uint16Array,e[pa]=Uint32Array,e[_a]=Uint32Array,e[da]=Uint32Array,e[ya]=Uint32Array,e[Ea]=Uint32Array}function ut(e){if(e instanceof Int8Array)return Fr;if(e instanceof Uint8Array||e instanceof Uint8ClampedArray)return $e;if(e instanceof Int16Array)return Ir;if(e instanceof Uint16Array)return Rr;if(e instanceof Int32Array)return Pr;if(e instanceof Uint32Array)return Br;if(e instanceof Float32Array)return Cr;throw new Error("unsupported typed array type")}function Ta(e){if(e===Int8Array)return Fr;if(e===Uint8Array||e===Uint8ClampedArray)return $e;if(e===Int16Array)return Ir;if(e===Uint16Array)return Rr;if(e===Int32Array)return Pr;if(e===Uint32Array)return Br;if(e===Float32Array)return Cr;throw new Error("unsupported typed array type")}function Aa(e){let t=Mn[e];if(!t)throw new Error("unknown gl type");return t}var He=typeof SharedArrayBuffer!="undefined"?function(t){return t&&t.buffer&&(t.buffer instanceof ArrayBuffer||t.buffer instanceof SharedArrayBuffer)}:function(t){return t&&t.buffer&&t.buffer instanceof ArrayBuffer};function ba(e,t,r){e.forEach(function(n){let o=t[n];o!==void 0&&(r[n]=o)})}function vn(...e){console.error(...e)}function ga(e,t){return typeof WebGLBuffer!="undefined"&&t instanceof WebGLBuffer}function Ma(e,t){return typeof WebGLRenderbuffer!="undefined"&&t instanceof WebGLRenderbuffer}function va(e,t){return typeof WebGLShader!="undefined"&&t instanceof WebGLShader}function Lr(e,t){return typeof WebGLTexture!="undefined"&&t instanceof WebGLTexture}function wa(e,t){return typeof WebGLSampler!="undefined"&&t instanceof WebGLSampler}var wn=35044,_e=34962,Sn=34963,Sa=34660,Fa=5120,Ia=5121,Ra=5122,Pa=5123,Ba=5124,Ca=5125,La=5126,Dr={attribPrefix:""};function Fn(e){Dr.attribPrefix=e}function Da(e,t,r,n,o){e.bindBuffer(t,r),e.bufferData(t,n,o||wn)}function Nr(e,t,r,n){if(ga(e,t))return t;r=r||_e;let o=e.createBuffer();return Da(e,r,o,t,n),o}function In(e){return e==="indices"}function Na(e){return e instanceof Int8Array||e instanceof Uint8Array}function Oa(e){return e===Int8Array||e===Uint8Array}function Or(e){return e.length?e:e.data}var Ua=/coord|texture/i,za=/color|colour/i;function Rn(e,t){let r;if(Ua.test(e)?r=2:za.test(e)?r=4:r=3,t%r>0)throw new Error(`Can not guess numComponents for attribute '${e}'. Tried ${r} but ${t} values is not evenly divisible by ${r}. You should specify it.`);return r}function Ur(e,t){return e.numComponents||e.size||Rn(t,Or(e).length)}function ft(e,t){if(He(e))return e;if(He(e.data))return e.data;Array.isArray(e)&&(e={data:e});let r=e.type;return r||(In(t)?r=Uint16Array:r=Float32Array),new r(e.data)}function Va(e,t){let r={};return Object.keys(t).forEach(function(n){if(!In(n)){let o=t[n],a=o.attrib||o.name||o.attribName||Dr.attribPrefix+n;if(o.value){if(!Array.isArray(o.value)&&!He(o.value))throw new Error("array.value is not array or typedarray");r[a]={value:o.value}}else{let l,s,i,c;if(o.buffer&&o.buffer instanceof WebGLBuffer)l=o.buffer,c=o.numComponents||o.size,s=o.type,i=o.normalize;else if(typeof o=="number"||typeof o.data=="number"){let u=o.data||o,h=o.type||Float32Array,m=u*h.BYTES_PER_ELEMENT;s=Ta(h),i=o.normalize!==void 0?o.normalize:Oa(h),c=o.numComponents||o.size||Rn(n,u),l=e.createBuffer(),e.bindBuffer(_e,l),e.bufferData(_e,m,o.drawType||wn)}else{let u=ft(o,n);l=Nr(e,u,void 0,o.drawType),s=ut(u),i=o.normalize!==void 0?o.normalize:Na(u),c=Ur(o,n)}r[a]={buffer:l,numComponents:c,type:s,normalize:i,stride:o.stride||0,offset:o.offset||0,divisor:o.divisor===void 0?void 0:o.divisor,drawType:o.drawType}}}}),e.bindBuffer(_e,null),r}function ka(e,t){return t===Fa||t===Ia?1:t===Ra||t===Pa?2:t===Ba||t===Ca||t===La?4:0}var Ne=["position","positions","a_position"];function Ga(e){let t,r;for(r=0;r<Ne.length&&(t=Ne[r],!(t in e));++r);r===Ne.length&&(t=Object.keys(e)[0]);let n=e[t],o=Or(n).length;if(o===void 0)return 1;let a=Ur(n,t),l=o/a;if(o%a>0)throw new Error(`numComponents ${a} not correct for length ${o}`);return l}function Ya(e,t){let r,n;for(n=0;n<Ne.length&&(r=Ne[n],!(r in t||(r=Dr.attribPrefix+r,r in t)));++n);n===Ne.length&&(r=Object.keys(t)[0]);let o=t[r];if(!o.buffer)return 1;e.bindBuffer(_e,o.buffer);let a=e.getBufferParameter(_e,Sa);e.bindBuffer(_e,null);let l=ka(e,o.type),s=a/l,i=o.numComponents||o.size,c=s/i;if(c%1!==0)throw new Error(`numComponents ${i} not correct for length ${length}`);return c}function ye(e,t,r){let n=Va(e,t),o=Object.assign({},r||{});o.attribs=Object.assign({},r?r.attribs:{},n);let a=t.indices;if(a){let l=ft(a,"indices");o.indices=Nr(e,l,Sn),o.numElements=l.length,o.elementType=ut(l)}else o.numElements||(o.numElements=Ya(e,o.attribs));return o}function Xa(e,t,r){let n=r==="indices"?Sn:_e,o=ft(t,r);return Nr(e,o,n)}function ja(e,t){let r={};return Object.keys(t).forEach(function(n){r[n]=Xa(e,t[n],n)}),t.indices?(r.numElements=t.indices.length,r.elementType=ut(ft(t.indices))):r.numElements=Ga(t),r}var Re=Or,$a=Ur;function Pn(e,t){let r=0;return e.push=function(){for(let n=0;n<arguments.length;++n){let o=arguments[n];if(o instanceof Array||He(o))for(let a=0;a<o.length;++a)e[r++]=o[a];else e[r++]=o}},e.reset=function(n){r=n||0},e.numComponents=t,Object.defineProperty(e,"numElements",{get:function(){return this.length/this.numComponents|0}}),e}function F(e,t,r){let n=r||Float32Array;return Pn(new n(e*t),e)}function Ha(e){return e!=="indices"}function Wa(e){let t=e.indices,r={},n=t.length;function o(a){let l=e[a],s=l.numComponents,i=F(s,n,l.constructor);for(let c=0;c<n;++c){let h=t[c]*s;for(let m=0;m<s;++m)i.push(l[h+m])}r[a]=i}return Object.keys(e).filter(Ha).forEach(o),r}function Ka(e){if(e.indices)throw new Error("can not flatten normals of indexed vertices. deindex them first");let t=e.normal,r=t.length;for(let n=0;n<r;n+=9){let o=t[n+0],a=t[n+1],l=t[n+2],s=t[n+3],i=t[n+4],c=t[n+5],u=t[n+6],h=t[n+7],m=t[n+8],x=o+s+u,f=a+i+h,p=l+c+m,_=Math.sqrt(x*x+f*f+p*p);x/=_,f/=_,p/=_,t[n+0]=x,t[n+1]=f,t[n+2]=p,t[n+3]=x,t[n+4]=f,t[n+5]=p,t[n+6]=x,t[n+7]=f,t[n+8]=p}return e}function zr(e,t,r){let n=e.length,o=new Float32Array(3);for(let a=0;a<n;a+=3)r(t,[e[a],e[a+1],e[a+2]],o),e[a]=o[0],e[a+1]=o[1],e[a+2]=o[2]}function qa(e,t,r){r=r||Sr();let n=t[0],o=t[1],a=t[2];return r[0]=n*e[0*4+0]+o*e[0*4+1]+a*e[0*4+2],r[1]=n*e[1*4+0]+o*e[1*4+1]+a*e[1*4+2],r[2]=n*e[2*4+0]+o*e[2*4+1]+a*e[2*4+2],r}function Bn(e,t){return zr(e,t,ua),e}function Cn(e,t){return zr(e,ca(t),qa),e}function Ln(e,t){return zr(e,t,la),e}function Dn(e,t){return Object.keys(e).forEach(function(r){let n=e[r];r.indexOf("pos")>=0?Ln(n,t):r.indexOf("tan")>=0||r.indexOf("binorm")>=0?Bn(n,t):r.indexOf("norm")>=0&&Cn(n,t)}),e}function Vr(e,t,r){return e=e||2,t=t||0,r=r||0,e*=.5,{position:{numComponents:2,data:[t+-1*e,r+-1*e,t+1*e,r+-1*e,t+-1*e,r+1*e,t+1*e,r+1*e]},normal:[0,0,1,0,0,1,0,0,1,0,0,1],texcoord:[0,0,1,0,0,1,1,1],indices:[0,1,2,2,1,3]}}function kr(e,t,r,n,o){e=e||1,t=t||1,r=r||1,n=n||1,o=o||sa();let a=(r+1)*(n+1),l=F(3,a),s=F(3,a),i=F(2,a);for(let m=0;m<=n;m++)for(let x=0;x<=r;x++){let f=x/r,p=m/n;l.push(e*f-e*.5,0,t*p-t*.5),s.push(0,1,0),i.push(f,p)}let c=r+1,u=F(3,r*n*2,Uint16Array);for(let m=0;m<n;m++)for(let x=0;x<r;x++)u.push((m+0)*c+x,(m+1)*c+x,(m+0)*c+x+1),u.push((m+1)*c+x,(m+1)*c+x+1,(m+0)*c+x+1);return Dn({position:l,normal:s,texcoord:i,indices:u},o)}function Gr(e,t,r,n,o,a,l){if(t<=0||r<=0)throw new Error("subdivisionAxis and subdivisionHeight must be > 0");n=n||0,o=o||Math.PI,a=a||0,l=l||Math.PI*2;let s=o-n,i=l-a,c=(t+1)*(r+1),u=F(3,c),h=F(3,c),m=F(2,c);for(let p=0;p<=r;p++)for(let _=0;_<=t;_++){let d=_/t,E=p/r,T=i*d+a,b=s*E+n,A=Math.sin(T),g=Math.cos(T),S=Math.sin(b),I=Math.cos(b),w=g*S,B=I,C=A*S;u.push(e*w,e*B,e*C),h.push(w,B,C),m.push(1-d,E)}let x=t+1,f=F(3,t*r*2,Uint16Array);for(let p=0;p<t;p++)for(let _=0;_<r;_++)f.push((_+0)*x+p,(_+0)*x+p+1,(_+1)*x+p),f.push((_+1)*x+p,(_+0)*x+p+1,(_+1)*x+p+1);return{position:u,normal:h,texcoord:m,indices:f}}var Za=[[3,7,5,1],[6,2,0,4],[6,7,3,2],[0,1,5,4],[7,6,4,5],[2,3,1,0]];function Yr(e){e=e||1;let t=e/2,r=[[-t,-t,-t],[+t,-t,-t],[-t,+t,-t],[+t,+t,-t],[-t,-t,+t],[+t,-t,+t],[-t,+t,+t],[+t,+t,+t]],n=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],o=[[1,0],[0,0],[0,1],[1,1]],a=6*4,l=F(3,a),s=F(3,a),i=F(2,a),c=F(3,6*2,Uint16Array);for(let u=0;u<6;++u){let h=Za[u];for(let x=0;x<4;++x){let f=r[h[x]],p=n[u],_=o[x];l.push(f),s.push(p),i.push(_)}let m=4*u;c.push(m+0,m+1,m+2),c.push(m+0,m+2,m+3)}return{position:l,normal:s,texcoord:i,indices:c}}function mt(e,t,r,n,o,a,l){if(n<3)throw new Error("radialSubdivisions must be 3 or greater");if(o<1)throw new Error("verticalSubdivisions must be 1 or greater");let s=a===void 0?!0:a,i=l===void 0?!0:l,c=(s?2:0)+(i?2:0),u=(n+1)*(o+1+c),h=F(3,u),m=F(3,u),x=F(2,u),f=F(3,n*(o+c/2)*2,Uint16Array),p=n+1,_=Math.atan2(e-t,r),d=Math.cos(_),E=Math.sin(_),T=s?-2:0,b=o+(i?2:0);for(let A=T;A<=b;++A){let g=A/o,S=r*g,I;A<0?(S=0,g=1,I=e):A>o?(S=r,g=1,I=t):I=e+(t-e)*(A/o),(A===-2||A===o+2)&&(I=0,g=0),S-=r/2;for(let w=0;w<p;++w){let B=Math.sin(w*Math.PI*2/n),C=Math.cos(w*Math.PI*2/n);h.push(B*I,S,C*I),A<0?m.push(0,-1,0):A>o?m.push(0,1,0):I===0?m.push(0,0,0):m.push(B*d,E,C*d),x.push(w/n,1-g)}}for(let A=0;A<o+c;++A)if(!(A===1&&s||A===o+c-2&&i))for(let g=0;g<n;++g)f.push(p*(A+0)+0+g,p*(A+0)+1+g,p*(A+1)+1+g),f.push(p*(A+0)+0+g,p*(A+1)+1+g,p*(A+1)+0+g);return{position:h,normal:m,texcoord:x,indices:f}}function hn(e,t){t=t||[];let r=[];for(let n=0;n<e.length;n+=4){let o=e[n],a=e.slice(n+1,n+4);a.push.apply(a,t);for(let l=0;l<o;++l)r.push.apply(r,a)}return r}function Xr(){let e=[0,0,0,0,150,0,30,0,0,0,150,0,30,150,0,30,0,0,30,0,0,30,30,0,100,0,0,30,30,0,100,30,0,100,0,0,30,60,0,30,90,0,67,60,0,30,90,0,67,90,0,67,60,0,0,0,30,30,0,30,0,150,30,0,150,30,30,0,30,30,150,30,30,0,30,100,0,30,30,30,30,30,30,30,100,0,30,100,30,30,30,60,30,67,60,30,30,90,30,30,90,30,67,60,30,67,90,30,0,0,0,100,0,0,100,0,30,0,0,0,100,0,30,0,0,30,100,0,0,100,30,0,100,30,30,100,0,0,100,30,30,100,0,30,30,30,0,30,30,30,100,30,30,30,30,0,100,30,30,100,30,0,30,30,0,30,60,30,30,30,30,30,30,0,30,60,0,30,60,30,30,60,0,67,60,30,30,60,30,30,60,0,67,60,0,67,60,30,67,60,0,67,90,30,67,60,30,67,60,0,67,90,0,67,90,30,30,90,0,30,90,30,67,90,30,30,90,0,67,90,30,67,90,0,30,90,0,30,150,30,30,90,30,30,90,0,30,150,0,30,150,30,0,150,0,0,150,30,30,150,30,0,150,0,30,150,30,30,150,0,0,0,0,0,0,30,0,150,30,0,0,0,0,150,30,0,150,0],t=[.22,.19,.22,.79,.34,.19,.22,.79,.34,.79,.34,.19,.34,.19,.34,.31,.62,.19,.34,.31,.62,.31,.62,.19,.34,.43,.34,.55,.49,.43,.34,.55,.49,.55,.49,.43,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,1,1,1,0,0,1,1,1,0],r=hn([18,0,0,1,18,0,0,-1,6,0,1,0,6,1,0,0,6,0,-1,0,6,1,0,0,6,0,1,0,6,1,0,0,6,0,-1,0,6,1,0,0,6,0,-1,0,6,-1,0,0]),n=hn([18,200,70,120,18,80,70,200,6,70,200,210,6,200,200,70,6,210,100,70,6,210,160,70,6,70,180,210,6,100,70,210,6,76,210,100,6,140,210,80,6,90,130,110,6,160,160,220],[255]),o=e.length/3,a={position:F(3,o),texcoord:F(2,o),normal:F(3,o),color:F(4,o,Uint8Array),indices:F(3,o/3,Uint16Array)};a.position.push(e),a.texcoord.push(t),a.normal.push(r),a.color.push(n);for(let l=0;l<o;++l)a.indices.push(l);return a}function ht(e,t,r,n,o,a,l){if(o<=0)throw new Error("subdivisionDown must be > 0");a=a||0,l=l||1;let s=2,i=l-a,c=(o+1)*2*(2+s),u=F(3,c),h=F(3,c),m=F(2,c);function x(E,T,b){return E+(T-E)*b}function f(E,T,b,A,g,S){for(let I=0;I<=o;I++){let w=T/(s-1),B=I/o,C=(w-.5)*2,V=(a+B*i)*Math.PI,U=Math.sin(V),q=Math.cos(V),k=x(e,E,U),G=C*n,Y=q*e,X=U*k;u.push(G,Y,X);let j=aa(ia([0,U,q],b),A);h.push(j),m.push(w*g+S,B)}}for(let E=0;E<s;E++){let T=(E/(s-1)-.5)*2;f(t,E,[1,1,1],[0,0,0],1,0),f(t,E,[0,0,0],[T,0,0],0,0),f(r,E,[1,1,1],[0,0,0],1,0),f(r,E,[0,0,0],[T,0,0],0,1)}let p=F(3,o*2*(2+s),Uint16Array);function _(E,T){for(let b=0;b<o;++b)p.push(E+b+0,E+b+1,T+b+0),p.push(E+b+1,T+b+1,T+b+0)}let d=o+1;return _(d*0,d*4),_(d*5,d*7),_(d*6,d*2),_(d*3,d*1),{position:u,normal:h,texcoord:m,indices:p}}function jr(e,t,r,n,o,a){return mt(e,e,t,r,n,o,a)}function $r(e,t,r,n,o,a){if(r<3)throw new Error("radialSubdivisions must be 3 or greater");if(n<3)throw new Error("verticalSubdivisions must be 3 or greater");o=o||0,a=a||Math.PI*2;let l=a-o,s=r+1,i=n+1,c=s*i,u=F(3,c),h=F(3,c),m=F(2,c),x=F(3,r*n*2,Uint16Array);for(let f=0;f<i;++f){let p=f/n,_=p*Math.PI*2,d=Math.sin(_),E=e+d*t,T=Math.cos(_),b=T*t;for(let A=0;A<s;++A){let g=A/r,S=o+g*l,I=Math.sin(S),w=Math.cos(S),B=I*E,C=w*E,V=I*d,U=w*d;u.push(B,b,C),h.push(V,T,U),m.push(g,1-p)}}for(let f=0;f<n;++f)for(let p=0;p<r;++p){let _=1+p,d=1+f;x.push(s*f+p,s*d+p,s*f+_),x.push(s*d+p,s*d+_,s*f+_)}return{position:u,normal:h,texcoord:m,indices:x}}function Hr(e,t,r,n,o){if(t<3)throw new Error("divisions must be at least 3");r=r||1,o=o||1,n=n||0;let a=(t+1)*(r+1),l=F(3,a),s=F(3,a),i=F(2,a),c=F(3,r*t*2,Uint16Array),u=0,h=e-n,m=t+1;for(let x=0;x<=r;++x){let f=n+h*Math.pow(x/r,o);for(let p=0;p<=t;++p){let _=2*Math.PI*p/t,d=f*Math.cos(_),E=f*Math.sin(_);if(l.push(d,0,E),s.push(0,1,0),i.push(1-p/t,x/r),x>0&&p!==t){let T=u+(p+1),b=u+p,A=u+p-m,g=u+(p+1)-m;c.push(T,b,A),c.push(T,A,g)}}u+=t+1}return{position:l,normal:s,texcoord:i,indices:c}}function Qa(e){return Math.random()*e|0}function Ja(e,t){t=t||{};let r=e.position.numElements,n=F(4,r,Uint8Array),o=t.rand||function(a,l){return l<3?Qa(256):255};if(e.color=n,e.indices)for(let a=0;a<r;++a)n.push(o(a,0),o(a,1),o(a,2),o(a,3));else{let a=t.vertsPerColor||3,l=r/a;for(let s=0;s<l;++s){let i=[o(s,0),o(s,1),o(s,2),o(s,3)];for(let c=0;c<a;++c)n.push(i)}}return e}function fe(e){return function(t){let r=e.apply(this,Array.prototype.slice.call(arguments,1));return ja(t,r)}}function me(e){return function(t){let r=e.apply(null,Array.prototype.slice.call(arguments,1));return ye(t,r)}}var ei=["numComponents","size","type","normalize","stride","offset","attrib","name","attribName"];function hr(e,t,r,n){n=n||0;let o=e.length;for(let a=0;a<o;++a)t[r+a]=e[a]+n}function Nn(e,t){let r=Re(e),n=new r.constructor(t),o=n;return r.numComponents&&r.numElements&&Pn(n,r.numComponents),e.data&&(o={data:n},ba(ei,e,o)),o}function ti(e){let t={},r;for(let s=0;s<e.length;++s){let i=e[s];Object.keys(i).forEach(function(c){t[c]||(t[c]=[]),!r&&c!=="indices"&&(r=c);let u=i[c],h=$a(u,c),x=Re(u).length/h;t[c].push(x)})}function n(s){let i=0,c;for(let u=0;u<e.length;++u){let m=e[u][s],x=Re(m);i+=x.length,(!c||m.data)&&(c=m)}return{length:i,spec:c}}function o(s,i,c){let u=0,h=0;for(let m=0;m<e.length;++m){let f=e[m][s],p=Re(f);s==="indices"?(hr(p,c,h,u),u+=i[m]):hr(p,c,h),h+=p.length}}let a=t[r],l={};return Object.keys(t).forEach(function(s){let i=n(s),c=Nn(i.spec,i.length);o(s,a,Re(c)),l[s]=c}),l}function ri(e){let t={};return Object.keys(e).forEach(function(r){let n=e[r],o=Re(n),a=Nn(n,o.length);hr(o,Re(a),0),t[r]=a}),t}var ni=me(Xr),oi=fe(Xr),ai=me(Yr),ii=fe(Yr),si=me(kr),ci=fe(kr),li=me(Gr),ui=fe(Gr),fi=me(mt),mi=fe(mt),hi=me(Vr),xi=fe(Vr),On=me(ht),Un=fe(ht),pi=me(jr),_i=fe(jr),di=me($r),yi=fe($r),Ei=me(Hr),Ti=fe(Hr),Ai=On,bi=Un,gi=ht,qe=Object.freeze({__proto__:null,create3DFBufferInfo:ni,create3DFBuffers:oi,create3DFVertices:Xr,createAugmentedTypedArray:F,createCubeBufferInfo:ai,createCubeBuffers:ii,createCubeVertices:Yr,createPlaneBufferInfo:si,createPlaneBuffers:ci,createPlaneVertices:kr,createSphereBufferInfo:li,createSphereBuffers:ui,createSphereVertices:Gr,createTruncatedConeBufferInfo:fi,createTruncatedConeBuffers:mi,createTruncatedConeVertices:mt,createXYQuadBufferInfo:hi,createXYQuadBuffers:xi,createXYQuadVertices:Vr,createCresentBufferInfo:Ai,createCresentBuffers:bi,createCresentVertices:gi,createCrescentBufferInfo:On,createCrescentBuffers:Un,createCrescentVertices:ht,createCylinderBufferInfo:pi,createCylinderBuffers:_i,createCylinderVertices:jr,createTorusBufferInfo:di,createTorusBuffers:yi,createTorusVertices:$r,createDiscBufferInfo:Ei,createDiscBuffers:Ti,createDiscVertices:Hr,deindexVertices:Wa,flattenNormals:Ka,makeRandomVertexColors:Ja,reorientDirections:Bn,reorientNormals:Cn,reorientPositions:Ln,reorientVertices:Dn,concatVertices:ti,duplicateVertices:ri});function Ze(e){return!!e.texStorage2D}var zn=function(){let e={},t={};function r(n){let o=n.constructor.name;if(!e[o]){for(let a in n)if(typeof n[a]=="number"){let l=t[n[a]];t[n[a]]=l?`${l} | ${a}`:a}e[o]=!0}}return function(o,a){return r(o),t[a]||(typeof a=="number"?`0x${a.toString(16)}`:a)}}();var Ee={textureColor:new Uint8Array([128,192,255,255]),textureOptions:{},crossOrigin:void 0},We=He,Vn=function(){let e;return function(){return e=e||(typeof document!="undefined"&&document.createElement?document.createElement("canvas").getContext("2d"):null),e}}(),xr=6406,oe=6407,L=6408,pr=6409,_r=6410,De=6402,dr=34041,it=33071,Mi=9728,vi=9729,Te=3553,de=34067,Pe=32879,Be=35866,Wr=34069,wi=34070,Si=34071,Fi=34072,Ii=34073,Ri=34074,yr=10241,Er=10240,st=10242,ct=10243,xn=32882,Pi=33082,Bi=33083,Ci=33084,Li=33085,Kr=3317,kn=3314,Gn=32878,Yn=3316,Xn=3315,jn=32877,Di=37443,Ni=37441,Oi=37440,Ui=33321,zi=36756,Vi=33325,ki=33326,Gi=33330,Yi=33329,Xi=33338,ji=33337,$i=33340,Hi=33339,Wi=33323,Ki=36757,qi=33327,Zi=33328,Qi=33336,Ji=33335,es=33332,ts=33331,rs=33334,ns=33333,os=32849,as=35905,is=36194,ss=36758,cs=35898,ls=35901,us=34843,fs=34837,ms=36221,hs=36239,xs=36215,ps=36233,_s=36209,ds=36227,ys=32856,Es=35907,Ts=36759,As=32855,bs=32854,gs=32857,Ms=34842,vs=34836,ws=36220,Ss=36238,Fs=36975,Is=36214,Rs=36232,Ps=36226,Bs=36208,Cs=33189,Ls=33190,Ds=36012,Ns=36013,Os=35056,xe=5120,N=5121,rt=5122,Le=5123,nt=5124,we=5125,K=5126,pn=32819,_n=32820,dn=33635,ie=5131,Ye=36193,fr=33640,Us=35899,zs=35902,Vs=36269,ks=34042,Xe=33319,Se=33320,je=6403,Fe=36244,Ie=36248,pe=36249,Gs={};{let e=Gs;e[xr]={numColorComponents:1},e[pr]={numColorComponents:1},e[_r]={numColorComponents:2},e[oe]={numColorComponents:3},e[L]={numColorComponents:4},e[je]={numColorComponents:1},e[Fe]={numColorComponents:1},e[Xe]={numColorComponents:2},e[Se]={numColorComponents:2},e[oe]={numColorComponents:3},e[Ie]={numColorComponents:3},e[L]={numColorComponents:4},e[pe]={numColorComponents:4},e[De]={numColorComponents:1},e[dr]={numColorComponents:2}}var mr;function xt(e){if(!mr){let t={};t[xr]={textureFormat:xr,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[N,ie,Ye,K]},t[pr]={textureFormat:pr,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[N,ie,Ye,K]},t[_r]={textureFormat:_r,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2,4,4,8],type:[N,ie,Ye,K]},t[oe]={textureFormat:oe,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,6,6,12,2],type:[N,ie,Ye,K,dn]},t[L]={textureFormat:L,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,8,8,16,2,2],type:[N,ie,Ye,K,pn,_n]},t[De]={textureFormat:De,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2,4],type:[we,Le]},t[Ui]={textureFormat:je,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1],type:[N]},t[zi]={textureFormat:je,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[1],type:[xe]},t[Vi]={textureFormat:je,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4,2],type:[K,ie]},t[ki]={textureFormat:je,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[4],type:[K]},t[Gi]={textureFormat:Fe,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[1],type:[N]},t[Yi]={textureFormat:Fe,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[1],type:[xe]},t[es]={textureFormat:Fe,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[Le]},t[ts]={textureFormat:Fe,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[rt]},t[rs]={textureFormat:Fe,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[we]},t[ns]={textureFormat:Fe,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[nt]},t[Wi]={textureFormat:Xe,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2],type:[N]},t[Ki]={textureFormat:Xe,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[2],type:[xe]},t[qi]={textureFormat:Xe,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[8,4],type:[K,ie]},t[Zi]={textureFormat:Xe,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[8],type:[K]},t[Qi]={textureFormat:Se,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[N]},t[Ji]={textureFormat:Se,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[xe]},t[Xi]={textureFormat:Se,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Le]},t[ji]={textureFormat:Se,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[rt]},t[$i]={textureFormat:Se,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[we]},t[Hi]={textureFormat:Se,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[nt]},t[os]={textureFormat:oe,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3],type:[N]},t[as]={textureFormat:oe,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[3],type:[N]},t[is]={textureFormat:oe,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,2],type:[N,dn]},t[ss]={textureFormat:oe,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[3],type:[xe]},t[cs]={textureFormat:oe,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[K,ie,Us]},t[ls]={textureFormat:oe,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[K,ie,zs]},t[us]={textureFormat:oe,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6],type:[K,ie]},t[fs]={textureFormat:oe,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[K]},t[ms]={textureFormat:Ie,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[3],type:[N]},t[hs]={textureFormat:Ie,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[3],type:[xe]},t[xs]={textureFormat:Ie,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[6],type:[Le]},t[ps]={textureFormat:Ie,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[6],type:[rt]},t[_s]={textureFormat:Ie,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[we]},t[ds]={textureFormat:Ie,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[nt]},t[ys]={textureFormat:L,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[N]},t[Es]={textureFormat:L,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[N]},t[Ts]={textureFormat:L,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4],type:[xe]},t[As]={textureFormat:L,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2,4],type:[N,_n,fr]},t[bs]={textureFormat:L,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2],type:[N,pn]},t[gs]={textureFormat:L,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[fr]},t[Ms]={textureFormat:L,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[16,8],type:[K,ie]},t[vs]={textureFormat:L,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[16],type:[K]},t[ws]={textureFormat:pe,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[N]},t[Ss]={textureFormat:pe,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[xe]},t[Fs]={textureFormat:pe,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[fr]},t[Is]={textureFormat:pe,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[Le]},t[Rs]={textureFormat:pe,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[rt]},t[Ps]={textureFormat:pe,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[16],type:[nt]},t[Bs]={textureFormat:pe,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[16],type:[we]},t[Cs]={textureFormat:De,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2,4],type:[Le,we]},t[Ls]={textureFormat:De,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[we]},t[Ds]={textureFormat:De,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[K]},t[Os]={textureFormat:dr,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[ks]},t[Ns]={textureFormat:dr,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Vs]},Object.keys(t).forEach(function(r){let n=t[r];n.bytesPerElementMap={},n.bytesPerElement.forEach(function(o,a){let l=n.type[a];n.bytesPerElementMap[l]=o})}),mr=t}return mr[e]}function Ys(e,t){let r=xt(e);if(!r)throw"unknown internal format";let n=r.bytesPerElementMap[t];if(n===void 0)throw"unknown internal format";return n}function Qe(e){let t=xt(e);if(!t)throw"unknown internal format";return{format:t.textureFormat,type:t.type[0]}}function yn(e){return(e&e-1)===0}function Xs(e,t,r,n){if(!Ze(e))return yn(t)&&yn(r);let o=xt(n);if(!o)throw"unknown internal format";return o.colorRenderable&&o.textureFilterable}function js(e){let t=xt(e);if(!t)throw"unknown internal format";return t.textureFilterable}function $s(e,t,r){return We(t)?ut(t):r||N}function ot(e,t,r,n,o){if(o%1!==0)throw"can't guess dimensions";if(!r&&!n){let a=Math.sqrt(o/(t===de?6:1));a%1===0?(r=a,n=a):(r=o,n=1)}else if(n){if(!r&&(r=o/n,r%1))throw"can't guess dimensions"}else if(n=o/r,n%1)throw"can't guess dimensions";return{width:r,height:n}}function Oe(e,t){t.colorspaceConversion!==void 0&&e.pixelStorei(Di,t.colorspaceConversion),t.premultiplyAlpha!==void 0&&e.pixelStorei(Ni,t.premultiplyAlpha),t.flipY!==void 0&&e.pixelStorei(Oi,t.flipY)}function $n(e){e.pixelStorei(Kr,4),Ze(e)&&(e.pixelStorei(kn,0),e.pixelStorei(Gn,0),e.pixelStorei(Yn,0),e.pixelStorei(Xn,0),e.pixelStorei(jn,0))}function Hs(e,t,r,n){n.minMag&&(r.call(e,t,yr,n.minMag),r.call(e,t,Er,n.minMag)),n.min&&r.call(e,t,yr,n.min),n.mag&&r.call(e,t,Er,n.mag),n.wrap&&(r.call(e,t,st,n.wrap),r.call(e,t,ct,n.wrap),(t===Pe||wa(e,t))&&r.call(e,t,xn,n.wrap)),n.wrapR&&r.call(e,t,xn,n.wrapR),n.wrapS&&r.call(e,t,st,n.wrapS),n.wrapT&&r.call(e,t,ct,n.wrapT),n.minLod&&r.call(e,t,Pi,n.minLod),n.maxLod&&r.call(e,t,Bi,n.maxLod),n.baseLevel&&r.call(e,t,Ci,n.baseLevel),n.maxLevel&&r.call(e,t,Li,n.maxLevel)}function Hn(e,t,r){let n=r.target||Te;e.bindTexture(n,t),Hs(e,n,e.texParameteri,r)}function Ws(e){return e=e||Ee.textureColor,We(e)?e:new Uint8Array([e[0]*255,e[1]*255,e[2]*255,e[3]*255])}function Tr(e,t,r,n,o,a){r=r||Ee.textureOptions,a=a||L;let l=r.target||Te;if(n=n||r.width,o=o||r.height,e.bindTexture(l,t),Xs(e,n,o,a))e.generateMipmap(l);else{let s=js(a)?vi:Mi;e.texParameteri(l,yr,s),e.texParameteri(l,Er,s),e.texParameteri(l,st,it),e.texParameteri(l,ct,it)}}function Ke(e){return e.auto===!0||e.auto===void 0&&e.level===void 0}function Ar(e,t){return t=t||{},t.cubeFaceOrder||[Wr,wi,Si,Fi,Ii,Ri]}function br(e,t){let n=Ar(e,t).map(function(o,a){return{face:o,ndx:a}});return n.sort(function(o,a){return o.face-a.face}),n}function Wn(e,t,r,n){n=n||Ee.textureOptions;let o=n.target||Te,a=n.level||0,l=r.width,s=r.height,i=n.internalFormat||n.format||L,c=Qe(i),u=n.format||c.format,h=n.type||c.type;if(Oe(e,n),e.bindTexture(o,t),o===de){let m=r.width,x=r.height,f,p;if(m/6===x)f=x,p=[0,0,1,0,2,0,3,0,4,0,5,0];else if(x/6===m)f=m,p=[0,0,0,1,0,2,0,3,0,4,0,5];else if(m/3===x/2)f=m/3,p=[0,0,1,0,2,0,0,1,1,1,2,1];else if(m/2===x/3)f=m/2,p=[0,0,1,0,0,1,1,1,0,2,1,2];else throw"can't figure out cube map from element: "+(r.src?r.src:r.nodeName);let _=Vn();_?(_.canvas.width=f,_.canvas.height=f,l=f,s=f,br(e,n).forEach(function(d){let E=p[d.ndx*2+0]*f,T=p[d.ndx*2+1]*f;_.drawImage(r,E,T,f,f,0,0,f,f),e.texImage2D(d.face,a,i,u,h,_.canvas)}),_.canvas.width=1,_.canvas.height=1):typeof createImageBitmap!="undefined"&&(l=f,s=f,br(e,n).forEach(function(d){let E=p[d.ndx*2+0]*f,T=p[d.ndx*2+1]*f;e.texImage2D(d.face,a,i,f,f,0,u,h,null),createImageBitmap(r,E,T,f,f,{premultiplyAlpha:"none",colorSpaceConversion:"none"}).then(function(b){Oe(e,n),e.bindTexture(o,t),e.texImage2D(d.face,a,i,u,h,b),Ke(n)&&Tr(e,t,n,l,s,i)})}))}else if(o===Pe||o===Be){let m=Math.min(r.width,r.height),x=Math.max(r.width,r.height),f=x/m;if(f%1!==0)throw"can not compute 3D dimensions of element";let p=r.width===x?1:0,_=r.height===x?1:0;e.pixelStorei(Kr,1),e.pixelStorei(kn,r.width),e.pixelStorei(Gn,0),e.pixelStorei(jn,0),e.texImage3D(o,a,i,m,m,m,0,u,h,null);for(let d=0;d<f;++d){let E=d*m*p,T=d*m*_;e.pixelStorei(Yn,E),e.pixelStorei(Xn,T),e.texSubImage3D(o,a,0,0,d,m,m,1,u,h,r)}$n(e)}else e.texImage2D(o,a,i,u,h,r);Ke(n)&&Tr(e,t,n,l,s,i),Hn(e,t,n)}function Ue(){}function Ks(e){if(typeof document!="undefined"){let t=document.createElement("a");return t.href=e,t.hostname===location.hostname&&t.port===location.port&&t.protocol===location.protocol}else{let t=new URL(location.href).origin;return new URL(e,location.href).origin===t}}function qs(e,t){return t===void 0&&!Ks(e)?"anonymous":t}function Zs(e,t,r){r=r||Ue;let n;if(t=t!==void 0?t:Ee.crossOrigin,t=qs(e,t),typeof Image!="undefined"){n=new Image,t!==void 0&&(n.crossOrigin=t);let o=function(){n.removeEventListener("error",a),n.removeEventListener("load",l),n=null},a=function(){let i="couldn't load image: "+e;vn(i),r(i,n),o()},l=function(){r(null,n),o()};return n.addEventListener("error",a),n.addEventListener("load",l),n.src=e,n}else if(typeof ImageBitmap!="undefined"){let o,a,l=function(){r(o,a)},s={};t&&(s.mode="cors"),fetch(e,s).then(function(i){if(!i.ok)throw i;return i.blob()}).then(function(i){return createImageBitmap(i,{premultiplyAlpha:"none",colorSpaceConversion:"none"})}).then(function(i){a=i,setTimeout(l)}).catch(function(i){o=i,setTimeout(l)}),n=null}return n}function Kn(e){return typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap||typeof ImageData!="undefined"&&e instanceof ImageData||typeof HTMLElement!="undefined"&&e instanceof HTMLElement}function qr(e,t,r){return Kn(e)?(setTimeout(function(){r(null,e)}),e):Zs(e,t,r)}function Zr(e,t,r){r=r||Ee.textureOptions;let n=r.target||Te;if(e.bindTexture(n,t),r.color===!1)return;let o=Ws(r.color);if(n===de)for(let a=0;a<6;++a)e.texImage2D(Wr+a,0,L,1,1,0,L,N,o);else n===Pe||n===Be?e.texImage3D(n,0,L,1,1,1,0,L,N,o):e.texImage2D(n,0,L,1,1,0,L,N,o)}function Qs(e,t,r,n){return n=n||Ue,r=r||Ee.textureOptions,Zr(e,t,r),r=Object.assign({},r),qr(r.src,r.crossOrigin,function(a,l){a?n(a,t,l):(Wn(e,t,l,r),n(null,t,l))})}function Js(e,t,r,n){n=n||Ue;let o=r.src;if(o.length!==6)throw"there must be 6 urls for a cubemap";let a=r.level||0,l=r.internalFormat||r.format||L,s=Qe(l),i=r.format||s.format,c=r.type||N,u=r.target||Te;if(u!==de)throw"target must be TEXTURE_CUBE_MAP";Zr(e,t,r),r=Object.assign({},r);let h=6,m=[],x=Ar(e,r),f;function p(_){return function(d,E){--h,d?m.push(d):E.width!==E.height?m.push("cubemap face img is not a square: "+E.src):(Oe(e,r),e.bindTexture(u,t),h===5?Ar().forEach(function(T){e.texImage2D(T,a,l,i,c,E)}):e.texImage2D(_,a,l,i,c,E),Ke(r)&&e.generateMipmap(u)),h===0&&n(m.length?m:void 0,t,f)}}f=o.map(function(_,d){return qr(_,r.crossOrigin,p(x[d]))})}function ec(e,t,r,n){n=n||Ue;let o=r.src,a=r.internalFormat||r.format||L,l=Qe(a),s=r.format||l.format,i=r.type||N,c=r.target||Be;if(c!==Pe&&c!==Be)throw"target must be TEXTURE_3D or TEXTURE_2D_ARRAY";Zr(e,t,r),r=Object.assign({},r);let u=o.length,h=[],m,x=r.level||0,f=r.width,p=r.height,_=o.length,d=!0;function E(T){return function(b,A){if(--u,b)h.push(b);else{if(Oe(e,r),e.bindTexture(c,t),d){d=!1,f=r.width||A.width,p=r.height||A.height,e.texImage3D(c,x,a,f,p,_,0,s,i,null);for(let g=0;g<_;++g)e.texSubImage3D(c,x,0,0,g,f,p,1,s,i,A)}else{let g=A,S;(A.width!==f||A.height!==p)&&(S=Vn(),g=S.canvas,S.canvas.width=f,S.canvas.height=p,S.drawImage(A,0,0,f,p)),e.texSubImage3D(c,x,0,0,T,f,p,1,s,i,g),S&&g===S.canvas&&(S.canvas.width=0,S.canvas.height=0)}Ke(r)&&e.generateMipmap(c)}u===0&&n(h.length?h:void 0,t,m)}}m=o.map(function(T,b){return qr(T,r.crossOrigin,E(b))})}function tc(e,t,r,n){n=n||Ee.textureOptions;let o=n.target||Te;e.bindTexture(o,t);let a=n.width,l=n.height,s=n.depth,i=n.level||0,c=n.internalFormat||n.format||L,u=Qe(c),h=n.format||u.format,m=n.type||$s(e,r,u.type);if(We(r))r instanceof Uint8ClampedArray&&(r=new Uint8Array(r.buffer));else{let _=Aa(m);r=new _(r)}let x=Ys(c,m),f=r.byteLength/x;if(f%1)throw"length wrong size for format: "+zn(e,h);let p;if(o===Pe||o===Be)if(!a&&!l&&!s){let _=Math.cbrt(f);if(_%1!==0)throw"can't guess cube size of array of numElements: "+f;a=_,l=_,s=_}else a&&(!l||!s)?(p=ot(e,o,l,s,f/a),l=p.width,s=p.height):l&&(!a||!s)?(p=ot(e,o,a,s,f/l),a=p.width,s=p.height):(p=ot(e,o,a,l,f/s),a=p.width,l=p.height);else p=ot(e,o,a,l,f),a=p.width,l=p.height;if($n(e),e.pixelStorei(Kr,n.unpackAlignment||1),Oe(e,n),o===de){let _=x/r.BYTES_PER_ELEMENT,d=f/6*_;br(e,n).forEach(E=>{let T=d*E.ndx,b=r.subarray(T,T+d);e.texImage2D(E.face,i,c,a,l,0,h,m,b)})}else o===Pe||o===Be?e.texImage3D(o,i,c,a,l,s,0,h,m,r):e.texImage2D(o,i,c,a,l,0,h,m,r);return{width:a,height:l,depth:s,type:m}}function rc(e,t,r){let n=r.target||Te;e.bindTexture(n,t);let o=r.level||0,a=r.internalFormat||r.format||L,l=Qe(a),s=r.format||l.format,i=r.type||l.type;if(Oe(e,r),n===de)for(let c=0;c<6;++c)e.texImage2D(Wr+c,o,a,r.width,r.height,0,s,i,null);else n===Pe||n===Be?e.texImage3D(n,o,a,r.width,r.height,r.depth,0,s,i,null):e.texImage2D(n,o,a,r.width,r.height,0,s,i,null)}function pt(e,t,r){r=r||Ue,t=t||Ee.textureOptions;let n=e.createTexture(),o=t.target||Te,a=t.width||1,l=t.height||1,s=t.internalFormat||L;e.bindTexture(o,n),o===de&&(e.texParameteri(o,st,it),e.texParameteri(o,ct,it));let i=t.src;if(i)if(typeof i=="function"&&(i=i(e,t)),typeof i=="string")Qs(e,n,t,r);else if(We(i)||Array.isArray(i)&&(typeof i[0]=="number"||Array.isArray(i[0])||We(i[0]))){let c=tc(e,n,i,t);a=c.width,l=c.height}else Array.isArray(i)&&(typeof i[0]=="string"||Kn(i[0]))?o===de?Js(e,n,t,r):ec(e,n,t,r):(Wn(e,n,i,t),a=i.width,l=i.height);else rc(e,n,t);return Ke(t)&&Tr(e,n,t,a,l,s),Hn(e,n,t),n}function nc(e){return typeof e=="string"||Array.isArray(e)&&typeof e[0]=="string"}function qn(e,t,r){r=r||Ue;let n=0,o=[],a={},l={};function s(){n===0&&setTimeout(function(){r(o.length?o:void 0,a,l)},0)}return Object.keys(t).forEach(function(i){let c=t[i],u;nc(c.src)&&(u=function(h,m,x){l[i]=x,--n,h&&o.push(h),s()},++n),a[i]=pt(e,c,u)}),s(),a}var _t=vn;function Zn(e){return typeof document!="undefined"&&document.getElementById?document.getElementById(e):null}var lt=33984;var dt=34962;var oc=35713,ac=35714,ic=35632,sc=35633,cc=35981,Qn=35718,lc=35721,uc=35971,fc=35382,mc=35396,hc=35398,xc=35392,pc=35395,yt=5126,Jn=35664,eo=35665,to=35666,Qr=5124,ro=35667,no=35668,oo=35669,ao=35670,io=35671,so=35672,co=35673,lo=35674,uo=35675,fo=35676,_c=35678,dc=35680,yc=35679,Ec=35682,Tc=35685,Ac=35686,bc=35687,gc=35688,Mc=35689,vc=35690,wc=36289,Sc=36292,Fc=36293,Jr=5125,mo=36294,ho=36295,xo=36296,Ic=36298,Rc=36299,Pc=36300,Bc=36303,Cc=36306,Lc=36307,Dc=36308,Nc=36311,Et=3553,Tt=34067,en=32879,At=35866,v={};function po(e,t){return v[t].bindPoint}function Oc(e,t){return function(r){e.uniform1f(t,r)}}function Uc(e,t){return function(r){e.uniform1fv(t,r)}}function zc(e,t){return function(r){e.uniform2fv(t,r)}}function Vc(e,t){return function(r){e.uniform3fv(t,r)}}function kc(e,t){return function(r){e.uniform4fv(t,r)}}function _o(e,t){return function(r){e.uniform1i(t,r)}}function yo(e,t){return function(r){e.uniform1iv(t,r)}}function Eo(e,t){return function(r){e.uniform2iv(t,r)}}function To(e,t){return function(r){e.uniform3iv(t,r)}}function Ao(e,t){return function(r){e.uniform4iv(t,r)}}function Gc(e,t){return function(r){e.uniform1ui(t,r)}}function Yc(e,t){return function(r){e.uniform1uiv(t,r)}}function Xc(e,t){return function(r){e.uniform2uiv(t,r)}}function jc(e,t){return function(r){e.uniform3uiv(t,r)}}function $c(e,t){return function(r){e.uniform4uiv(t,r)}}function Hc(e,t){return function(r){e.uniformMatrix2fv(t,!1,r)}}function Wc(e,t){return function(r){e.uniformMatrix3fv(t,!1,r)}}function Kc(e,t){return function(r){e.uniformMatrix4fv(t,!1,r)}}function qc(e,t){return function(r){e.uniformMatrix2x3fv(t,!1,r)}}function Zc(e,t){return function(r){e.uniformMatrix3x2fv(t,!1,r)}}function Qc(e,t){return function(r){e.uniformMatrix2x4fv(t,!1,r)}}function Jc(e,t){return function(r){e.uniformMatrix4x2fv(t,!1,r)}}function el(e,t){return function(r){e.uniformMatrix3x4fv(t,!1,r)}}function tl(e,t){return function(r){e.uniformMatrix4x3fv(t,!1,r)}}function Z(e,t,r,n){let o=po(e,t);return Ze(e)?function(a){let l,s;Lr(e,a)?(l=a,s=null):(l=a.texture,s=a.sampler),e.uniform1i(n,r),e.activeTexture(lt+r),e.bindTexture(o,l),e.bindSampler(r,s)}:function(a){e.uniform1i(n,r),e.activeTexture(lt+r),e.bindTexture(o,a)}}function Q(e,t,r,n,o){let a=po(e,t),l=new Int32Array(o);for(let s=0;s<o;++s)l[s]=r+s;return Ze(e)?function(s){e.uniform1iv(n,l),s.forEach(function(i,c){e.activeTexture(lt+l[c]);let u,h;Lr(e,i)?(u=i,h=null):(u=i.texture,h=i.sampler),e.bindSampler(r,h),e.bindTexture(a,u)})}:function(s){e.uniform1iv(n,l),s.forEach(function(i,c){e.activeTexture(lt+l[c]),e.bindTexture(a,i)})}}v[yt]={Type:Float32Array,size:4,setter:Oc,arraySetter:Uc};v[Jn]={Type:Float32Array,size:8,setter:zc,cols:2};v[eo]={Type:Float32Array,size:12,setter:Vc,cols:3};v[to]={Type:Float32Array,size:16,setter:kc,cols:4};v[Qr]={Type:Int32Array,size:4,setter:_o,arraySetter:yo};v[ro]={Type:Int32Array,size:8,setter:Eo,cols:2};v[no]={Type:Int32Array,size:12,setter:To,cols:3};v[oo]={Type:Int32Array,size:16,setter:Ao,cols:4};v[Jr]={Type:Uint32Array,size:4,setter:Gc,arraySetter:Yc};v[mo]={Type:Uint32Array,size:8,setter:Xc,cols:2};v[ho]={Type:Uint32Array,size:12,setter:jc,cols:3};v[xo]={Type:Uint32Array,size:16,setter:$c,cols:4};v[ao]={Type:Uint32Array,size:4,setter:_o,arraySetter:yo};v[io]={Type:Uint32Array,size:8,setter:Eo,cols:2};v[so]={Type:Uint32Array,size:12,setter:To,cols:3};v[co]={Type:Uint32Array,size:16,setter:Ao,cols:4};v[lo]={Type:Float32Array,size:32,setter:Hc,rows:2,cols:2};v[uo]={Type:Float32Array,size:48,setter:Wc,rows:3,cols:3};v[fo]={Type:Float32Array,size:64,setter:Kc,rows:4,cols:4};v[Tc]={Type:Float32Array,size:32,setter:qc,rows:2,cols:3};v[Ac]={Type:Float32Array,size:32,setter:Qc,rows:2,cols:4};v[bc]={Type:Float32Array,size:48,setter:Zc,rows:3,cols:2};v[gc]={Type:Float32Array,size:48,setter:el,rows:3,cols:4};v[Mc]={Type:Float32Array,size:64,setter:Jc,rows:4,cols:2};v[vc]={Type:Float32Array,size:64,setter:tl,rows:4,cols:3};v[_c]={Type:null,size:0,setter:Z,arraySetter:Q,bindPoint:Et};v[dc]={Type:null,size:0,setter:Z,arraySetter:Q,bindPoint:Tt};v[yc]={Type:null,size:0,setter:Z,arraySetter:Q,bindPoint:en};v[Ec]={Type:null,size:0,setter:Z,arraySetter:Q,bindPoint:Et};v[wc]={Type:null,size:0,setter:Z,arraySetter:Q,bindPoint:At};v[Sc]={Type:null,size:0,setter:Z,arraySetter:Q,bindPoint:At};v[Fc]={Type:null,size:0,setter:Z,arraySetter:Q,bindPoint:Tt};v[Ic]={Type:null,size:0,setter:Z,arraySetter:Q,bindPoint:Et};v[Rc]={Type:null,size:0,setter:Z,arraySetter:Q,bindPoint:en};v[Pc]={Type:null,size:0,setter:Z,arraySetter:Q,bindPoint:Tt};v[Bc]={Type:null,size:0,setter:Z,arraySetter:Q,bindPoint:At};v[Cc]={Type:null,size:0,setter:Z,arraySetter:Q,bindPoint:Et};v[Lc]={Type:null,size:0,setter:Z,arraySetter:Q,bindPoint:en};v[Dc]={Type:null,size:0,setter:Z,arraySetter:Q,bindPoint:Tt};v[Nc]={Type:null,size:0,setter:Z,arraySetter:Q,bindPoint:At};function bt(e,t){return function(r){if(r.value)switch(e.disableVertexAttribArray(t),r.value.length){case 4:e.vertexAttrib4fv(t,r.value);break;case 3:e.vertexAttrib3fv(t,r.value);break;case 2:e.vertexAttrib2fv(t,r.value);break;case 1:e.vertexAttrib1fv(t,r.value);break;default:throw new Error("the length of a float constant value must be between 1 and 4!")}else e.bindBuffer(dt,r.buffer),e.enableVertexAttribArray(t),e.vertexAttribPointer(t,r.numComponents||r.size,r.type||yt,r.normalize||!1,r.stride||0,r.offset||0),r.divisor!==void 0&&e.vertexAttribDivisor(t,r.divisor)}}function Ae(e,t){return function(r){if(r.value)if(e.disableVertexAttribArray(t),r.value.length===4)e.vertexAttrib4iv(t,r.value);else throw new Error("The length of an integer constant value must be 4!");else e.bindBuffer(dt,r.buffer),e.enableVertexAttribArray(t),e.vertexAttribIPointer(t,r.numComponents||r.size,r.type||Qr,r.stride||0,r.offset||0),r.divisor!==void 0&&e.vertexAttribDivisor(t,r.divisor)}}function gt(e,t){return function(r){if(r.value)if(e.disableVertexAttribArray(t),r.value.length===4)e.vertexAttrib4uiv(t,r.value);else throw new Error("The length of an unsigned integer constant value must be 4!");else e.bindBuffer(dt,r.buffer),e.enableVertexAttribArray(t),e.vertexAttribIPointer(t,r.numComponents||r.size,r.type||Jr,r.stride||0,r.offset||0),r.divisor!==void 0&&e.vertexAttribDivisor(t,r.divisor)}}function tn(e,t,r){let n=r.size,o=r.count;return function(a){e.bindBuffer(dt,a.buffer);let l=a.size||a.numComponents||n,s=l/o,i=a.type||yt,u=v[i].size*l,h=a.normalize||!1,m=a.offset||0,x=u/o;for(let f=0;f<o;++f)e.enableVertexAttribArray(t+f),e.vertexAttribPointer(t+f,s,i,h,u,m+x*f),a.divisor!==void 0&&e.vertexAttribDivisor(t+f,a.divisor)}}var z={};z[yt]={size:4,setter:bt};z[Jn]={size:8,setter:bt};z[eo]={size:12,setter:bt};z[to]={size:16,setter:bt};z[Qr]={size:4,setter:Ae};z[ro]={size:8,setter:Ae};z[no]={size:12,setter:Ae};z[oo]={size:16,setter:Ae};z[Jr]={size:4,setter:gt};z[mo]={size:8,setter:gt};z[ho]={size:12,setter:gt};z[xo]={size:16,setter:gt};z[ao]={size:4,setter:Ae};z[io]={size:8,setter:Ae};z[so]={size:12,setter:Ae};z[co]={size:16,setter:Ae};z[lo]={size:4,setter:tn,count:2};z[uo]={size:9,setter:tn,count:3};z[fo]={size:16,setter:tn,count:4};var rl=/ERROR:\s*\d+:(\d+)/gi;function nl(e,t="",r=0){let n=[...t.matchAll(rl)],o=new Map(n.map((a,l)=>{let s=parseInt(a[1]),i=n[l+1],c=i?i.index:t.length,u=t.substring(a.index,c);return[s-1,u]}));return e.split(`
`).map((a,l)=>{let s=o.get(l);return`${l+1+r}: ${a}${s?`

^^^ ${s}`:""}`}).join(`
`)}var En=/^[ \t]*\n/;function bo(e){let t=0;return En.test(e)&&(t=1,e=e.replace(En,"")),{lineOffset:t,shaderSource:e}}function go(e,t){return e.errorCallback(t),e.callback&&setTimeout(()=>{e.callback(`${t}
${e.errors.join(`
`)}`)}),null}function Mo(e,t,r,n){let o=e.createShader(r);return e.shaderSource(o,bo(t).shaderSource),e.compileShader(o),!n.callback&&!ol(e,r,o,n.errorCallback)?(e.deleteShader(o),null):o}function ol(e,t,r,n){n=n||_t;let o=e.getShaderParameter(r,oc);if(!o){let a=e.getShaderInfoLog(r),{lineOffset:l,shaderSource:s}=bo(e.getShaderSource(r));n(`${nl(s,a,l)}
Error compiling ${zn(e,t)}: ${a}`)}return o}function rn(e,t,r){let n,o,a;if(typeof t=="function"&&(r=t,t=void 0),typeof e=="function")r=e,e=void 0;else if(e&&!Array.isArray(e)){if(e.errorCallback&&e.errors)return e;let c=e;r=c.errorCallback,e=c.attribLocations,n=c.transformFeedbackVaryings,o=c.transformFeedbackMode,a=c.callback}let l=r||_t,s=[],i={errorCallback(c,...u){s.push(c),l(c,...u)},transformFeedbackVaryings:n,transformFeedbackMode:o,callback:a,errors:s};if(e){let c={};Array.isArray(e)?e.forEach(function(u,h){c[u]=t?t[h]:h}):c=e,i.attribLocations=c}return i}var vo=["VERTEX_SHADER","FRAGMENT_SHADER"];function al(e,t){if(t.indexOf("frag")>=0)return ic;if(t.indexOf("vert")>=0)return sc}function Tn(e,t){t.forEach(function(r){e.deleteShader(r)})}var il=(e=0)=>new Promise(t=>setTimeout(t,e));function sl(e,t,r,n,o){let a=rn(r,n,o),l=[],s=[];for(let u=0;u<t.length;++u){let h=t[u];if(typeof h=="string"){let m=Zn(h),x=m?m.text:h,f=e[vo[u]];m&&m.type&&(f=al(e,m.type)||f),h=Mo(e,x,f,a),s.push(h)}va(e,h)&&l.push(h)}if(l.length!==t.length)return Tn(e,s),go(a,"not enough shaders for program");let i=e.createProgram();l.forEach(function(u){e.attachShader(i,u)}),a.attribLocations&&Object.keys(a.attribLocations).forEach(function(u){e.bindAttribLocation(i,a.attribLocations[u],u)});let c=a.transformFeedbackVaryings;return c&&(c.attribs&&(c=c.attribs),Array.isArray(c)||(c=Object.keys(c)),e.transformFeedbackVaryings(i,c,a.transformFeedbackMode||cc)),e.linkProgram(i),a.callback?(cl(e,i,a),null):wo(e,i,a.errorCallback)?i:(e.deleteProgram(i),Tn(e,s),null)}function cl(e,t,r){return ve(this,null,function*(){let n=e.getExtension("KHR_parallel_shader_compile"),o=n?(i,c)=>i.getProgramParameter(c,n.COMPLETION_STATUS_KHR):()=>!0,a=0;do yield il(a),a=1e3/60;while(!o(e,t));let l=wo(e,t,r.errorCallback),s=l?void 0:r.errors.join(`
`);l||((r.errorCallback||_t)(s),e.deleteProgram(t),t=null),r.callback(s,t)})}function wo(e,t,r){r=r||_t;let n=e.getProgramParameter(t,ac);if(!n){let o=e.getProgramInfoLog(t);r(`Error in program linking: ${o}`)}return n}function ll(e,t,r,n,o){let a=rn(r,n,o),l=[];for(let s=0;s<t.length;++s){let i=Mo(e,t[s],e[vo[s]],a);if(!a.callback&&!i)return null;l.push(i)}return sl(e,l,a)}function So(e){let t=e.name;return t.startsWith("gl_")||t.startsWith("webgl_")}var ul=/(\.|\[|]|\w+)/g,fl=e=>e>="0"&&e<="9";function ml(e,t,r,n){let o=e.split(ul).filter(s=>s!==""),a=0,l="";for(;;){let s=o[a++];l+=s;let i=fl(s[0]),c=i?parseInt(s):s;if(i&&(l+=o[a++]),a===o.length){r[c]=t;break}else{let h=o[a++],m=h==="[",x=r[c]||(m?[]:{});r[c]=x,r=x,n[l]=n[l]||function(f){return function(p){Fo(f,p)}}(x),l+=h}}}function hl(e,t){let r=0;function n(s,i,c){let u=i.name.endsWith("[0]"),h=i.type,m=v[h];if(!m)throw new Error(`unknown type: 0x${h.toString(16)}`);let x;if(m.bindPoint){let f=r;r+=i.size,u?x=m.arraySetter(e,h,f,c,i.size):x=m.setter(e,h,f,c,i.size)}else m.arraySetter&&u?x=m.arraySetter(e,c):x=m.setter(e,c);return x.location=c,x}let o={},a={},l=e.getProgramParameter(t,Qn);for(let s=0;s<l;++s){let i=e.getActiveUniform(t,s);if(So(i))continue;let c=i.name;c.endsWith("[0]")&&(c=c.substr(0,c.length-3));let u=e.getUniformLocation(t,i.name);if(u){let h=n(t,i,u);o[c]=h,ml(c,h,a,o)}}return o}function xl(e,t){let r={},n=e.getProgramParameter(t,uc);for(let o=0;o<n;++o){let a=e.getTransformFeedbackVarying(t,o);r[a.name]={index:o,type:a.type,size:a.size}}return r}function pl(e,t){let r=e.getProgramParameter(t,Qn),n=[],o=[];for(let s=0;s<r;++s){o.push(s),n.push({});let i=e.getActiveUniform(t,s);n[s].name=i.name}[["UNIFORM_TYPE","type"],["UNIFORM_SIZE","size"],["UNIFORM_BLOCK_INDEX","blockNdx"],["UNIFORM_OFFSET","offset"]].forEach(function(s){let i=s[0],c=s[1];e.getActiveUniforms(t,o,e[i]).forEach(function(u,h){n[h][c]=u})});let a={},l=e.getProgramParameter(t,fc);for(let s=0;s<l;++s){let i=e.getActiveUniformBlockName(t,s),c={index:e.getUniformBlockIndex(t,i),usedByVertexShader:e.getActiveUniformBlockParameter(t,s,mc),usedByFragmentShader:e.getActiveUniformBlockParameter(t,s,hc),size:e.getActiveUniformBlockParameter(t,s,xc),uniformIndices:e.getActiveUniformBlockParameter(t,s,pc)};c.used=c.usedByVertexShader||c.usedByFragmentShader,a[i]=c}return{blockSpecs:a,uniformData:n}}function Fo(e,t){for(let r in t){let n=e[r];typeof n=="function"?n(t[r]):Fo(e[r],t[r])}}function ae(e,...t){let r=e.uniformSetters||e,n=t.length;for(let o=0;o<n;++o){let a=t[o];if(Array.isArray(a)){let l=a.length;for(let s=0;s<l;++s)ae(r,a[s])}else for(let l in a){let s=r[l];s&&s(a[l])}}}function _l(e,t){let r={},n=e.getProgramParameter(t,lc);for(let o=0;o<n;++o){let a=e.getActiveAttrib(t,o);if(So(a))continue;let l=e.getAttribLocation(t,a.name),s=z[a.type],i=s.setter(e,l,s);i.location=l,r[a.name]=i}return r}function dl(e,t){for(let r in t){let n=e[r];n&&n(t[r])}}function An(e,t){let r=hl(e,t),n=_l(e,t),o={program:t,uniformSetters:r,attribSetters:n};return Ze(e)&&(o.uniformBlockSpec=pl(e,t),o.transformFeedbackInfo=xl(e,t)),o}var yl=/\s|{|}|;/;function be(e,t,r,n,o){let a=rn(r,n,o),l=[];if(t=t.map(function(c){if(!yl.test(c)){let u=Zn(c);if(u)c=u.text;else{let h=`no element with id: ${c}`;a.errorCallback(h),l.push(h)}}return c}),l.length)return go(a,"");let s=a.callback;s&&(a.callback=(c,u)=>{let h;c||(h=An(e,u)),s(c,h)});let i=ll(e,t,a);return i?An(e,i):null}var El=4,bn=5123;function Ce(e,t,r,n,o,a){r=r===void 0?El:r;let l=t.indices,s=t.elementType,i=n===void 0?t.numElements:n;o=o===void 0?0:o,s||l?a!==void 0?e.drawElementsInstanced(r,i,s===void 0?bn:t.elementType,o,a):e.drawElements(r,i,s===void 0?bn:t.elementType,o):a!==void 0?e.drawArraysInstanced(r,o,i,a):e.drawArrays(r,o,i)}var Io=36160,at=36161,Tl=3553,Al=5121,bl=6402,Ml=6408,vl=33190,wl=36012,Sl=35056,Fl=36013,Il=32854,Rl=32855,Pl=36194,Ro=33189,Po=6401,Bo=36168,nn=34041,gr=36064,Mt=36096,Co=36128,on=33306,Mr=33071,vr=9729,Bl=[{format:Ml,type:Al,min:vr,wrap:Mr},{format:nn}],se={};se[nn]=on;se[Po]=Co;se[Bo]=Co;se[bl]=Mt;se[Ro]=Mt;se[vl]=Mt;se[wl]=Mt;se[Sl]=on;se[Fl]=on;function Cl(e,t){return se[e]||se[t]}var ge={};ge[Il]=!0;ge[Rl]=!0;ge[Pl]=!0;ge[nn]=!0;ge[Ro]=!0;ge[Po]=!0;ge[Bo]=!0;function Ll(e){return ge[e]}var Dl=32;function Nl(e){return e>=gr&&e<gr+Dl}function vt(e,t,r,n){let o=Io,a=e.createFramebuffer();e.bindFramebuffer(o,a),r=r||e.drawingBufferWidth,n=n||e.drawingBufferHeight,t=t||Bl;let l=[],s={framebuffer:a,attachments:[],width:r,height:n};return t.forEach(function(i,c){let u=i.attachment,h=i.samples,m=i.format,x=i.attachmentPoint||Cl(m,i.internalFormat);if(x||(x=gr+c),Nl(x)&&l.push(x),!u)if(h!==void 0||Ll(m))u=e.createRenderbuffer(),e.bindRenderbuffer(at,u),h>1?e.renderbufferStorageMultisample(at,h,m,r,n):e.renderbufferStorage(at,m,r,n);else{let f=Object.assign({},i);f.width=r,f.height=n,f.auto===void 0&&(f.auto=!1,f.min=f.min||f.minMag||vr,f.mag=f.mag||f.minMag||vr,f.wrapS=f.wrapS||f.wrap||Mr,f.wrapT=f.wrapT||f.wrap||Mr),u=pt(e,f)}if(Ma(e,u))e.framebufferRenderbuffer(o,x,at,u);else if(Lr(e,u))i.layer!==void 0?e.framebufferTextureLayer(o,x,u,i.level||0,i.layer):e.framebufferTexture2D(o,x,i.target||Tl,u,i.level||0);else throw new Error("unknown attachment type");s.attachments.push(u)}),e.drawBuffers&&e.drawBuffers(l),s}function Je(e,t,r){r=r||Io,t?(e.bindFramebuffer(r,t.framebuffer),e.viewport(0,0,t.width,t.height)):(e.bindFramebuffer(r,null),e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight))}var Ol=34963;function Ul(e,t,r,n){let o=e.createVertexArray();return e.bindVertexArray(o),dl(t,r),n&&e.bindBuffer(Ol,n),e.bindVertexArray(null),o}function ze(e,t,r){return Ul(e,t.attribSetters||t,r.attribs,r.indices)}function Lo(e,t){t=t||1,t=Math.max(0,t);let r=e.clientWidth*t|0,n=e.clientHeight*t|0;return e.width!==r||e.height!==n?(e.width=r,e.height=n,!0):!1}var R,an={d:(e,t)=>{for(var r in t)an.o(t,r)&&!an.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},re={};an.d(re,{ah:()=>P,i1:()=>et,Ar:()=>M,F5:()=>ke,Jc:()=>tt,Kj:()=>Ve,NQ:()=>Gl,vK:()=>R,R9:()=>zo,Ml:()=>Oo,LT:()=>No,cP:()=>Uo,i8:()=>Vo}),function(e){e.BYTE="BYTE",e.UNSIGNED_BYTE="UNSIGNED_BYTE",e.SHORT="SHORT",e.UNSIGNED_SHORT="UNSIGNED_SHORT",e.FLOAT="FLOAT"}(R||(R={}));var et=class extends Error{constructor(t){super(`found duplicate attribute: ${t.key}`)}},P=class{constructor(t,r,n,o=!1){switch(this.key=t,this.size=r,this.type=n,this.normalized=o,n){case"BYTE":case"UNSIGNED_BYTE":this.sizeOfType=1;break;case"SHORT":case"UNSIGNED_SHORT":this.sizeOfType=2;break;case"FLOAT":this.sizeOfType=4;break;default:throw new Error(`Unknown gl type: ${n}`)}this.sizeInBytes=this.sizeOfType*r}},M=class{constructor(...t){this.attributes=t,this.attributeMap={};let r=0,n=0;for(let o of t){if(this.attributeMap[o.key])throw new et(o);r%o.sizeOfType!=0&&(r+=o.sizeOfType-r%o.sizeOfType,console.warn("Layout requires padding before "+o.key+" attribute")),this.attributeMap[o.key]={attribute:o,size:o.size,type:o.type,normalized:o.normalized,offset:r},r+=o.sizeInBytes,n=Math.max(n,o.sizeOfType)}r%n!=0&&(r+=n-r%n,console.warn("Layout requires padding at the back")),this.stride=r;for(let o of t)this.attributeMap[o.key].stride=this.stride}};M.POSITION=new P("position",3,R.FLOAT),M.NORMAL=new P("normal",3,R.FLOAT),M.TANGENT=new P("tangent",3,R.FLOAT),M.BITANGENT=new P("bitangent",3,R.FLOAT),M.UV=new P("uv",2,R.FLOAT),M.MATERIAL_INDEX=new P("materialIndex",1,R.SHORT),M.MATERIAL_ENABLED=new P("materialEnabled",1,R.UNSIGNED_SHORT),M.AMBIENT=new P("ambient",3,R.FLOAT),M.DIFFUSE=new P("diffuse",3,R.FLOAT),M.SPECULAR=new P("specular",3,R.FLOAT),M.SPECULAR_EXPONENT=new P("specularExponent",3,R.FLOAT),M.EMISSIVE=new P("emissive",3,R.FLOAT),M.TRANSMISSION_FILTER=new P("transmissionFilter",3,R.FLOAT),M.DISSOLVE=new P("dissolve",1,R.FLOAT),M.ILLUMINATION=new P("illumination",1,R.UNSIGNED_SHORT),M.REFRACTION_INDEX=new P("refractionIndex",1,R.FLOAT),M.SHARPNESS=new P("sharpness",1,R.FLOAT),M.MAP_DIFFUSE=new P("mapDiffuse",1,R.SHORT),M.MAP_AMBIENT=new P("mapAmbient",1,R.SHORT),M.MAP_SPECULAR=new P("mapSpecular",1,R.SHORT),M.MAP_SPECULAR_EXPONENT=new P("mapSpecularExponent",1,R.SHORT),M.MAP_DISSOLVE=new P("mapDissolve",1,R.SHORT),M.ANTI_ALIASING=new P("antiAliasing",1,R.UNSIGNED_SHORT),M.MAP_BUMP=new P("mapBump",1,R.SHORT),M.MAP_DISPLACEMENT=new P("mapDisplacement",1,R.SHORT),M.MAP_DECAL=new P("mapDecal",1,R.SHORT),M.MAP_EMISSIVE=new P("mapEmissive",1,R.SHORT);var Ve=class{constructor(t,r){this.name="",this.indicesPerMaterial=[],this.materialsByIndex={},this.tangents=[],this.bitangents=[],(r=r||{}).materials=r.materials||{},r.enableWTextureCoord=!!r.enableWTextureCoord,this.vertexNormals=[],this.textures=[],this.indices=[],this.textureStride=r.enableWTextureCoord?3:2;let n=[],o=[],a=[],l=[],s={},i=-1,c=0,u={verts:[],norms:[],textures:[],hashindices:{},indices:[[]],materialIndices:[],index:0},h=/^v\s/,m=/^vn\s/,x=/^vt\s/,f=/^f\s/,p=/\s+/,_=/^usemtl/,d=t.split(`
`);for(let E of d){if(E=E.trim(),!E||E.startsWith("#"))continue;let T=E.split(p);if(T.shift(),h.test(E))n.push(...T);else if(m.test(E))o.push(...T);else if(x.test(E)){let b=T;T.length>2&&!r.enableWTextureCoord?b=T.slice(0,2):T.length===2&&r.enableWTextureCoord&&b.push("0"),a.push(...b)}else if(_.test(E)){let b=T[0];b in s||(l.push(b),s[b]=l.length-1,s[b]>0&&u.indices.push([])),i=s[b],c=i}else if(f.test(E)){let b=Vl(T);for(let A of b)for(let g=0,S=A.length;g<S;g++){let I=A[g]+","+i;if(I in u.hashindices)u.indices[c].push(u.hashindices[I]);else{let w=A[g].split("/"),B=w.length-1;if(u.verts.push(+n[3*(+w[0]-1)+0]),u.verts.push(+n[3*(+w[0]-1)+1]),u.verts.push(+n[3*(+w[0]-1)+2]),a.length){let C=r.enableWTextureCoord?3:2;u.textures.push(+a[(+w[1]-1)*C+0]),u.textures.push(+a[(+w[1]-1)*C+1]),r.enableWTextureCoord&&u.textures.push(+a[(+w[1]-1)*C+2])}u.norms.push(+o[3*(+w[B]-1)+0]),u.norms.push(+o[3*(+w[B]-1)+1]),u.norms.push(+o[3*(+w[B]-1)+2]),u.materialIndices.push(i),u.hashindices[I]=u.index,u.indices[c].push(u.hashindices[I]),u.index+=1}}}}this.vertices=u.verts,this.vertexNormals=u.norms,this.textures=u.textures,this.vertexMaterialIndices=u.materialIndices,this.indices=u.indices[c],this.indicesPerMaterial=u.indices,this.materialNames=l,this.materialIndices=s,this.materialsByIndex={},r.calcTangentsAndBitangents&&this.calculateTangentsAndBitangents()}calculateTangentsAndBitangents(){console.assert(!!(this.vertices&&this.vertices.length&&this.vertexNormals&&this.vertexNormals.length&&this.textures&&this.textures.length),"Missing attributes for calculating tangents and bitangents");let t={tangents:[...new Array(this.vertices.length)].map(l=>0),bitangents:[...new Array(this.vertices.length)].map(l=>0)},r=this.indices,n=this.vertices,o=this.vertexNormals,a=this.textures;for(let l=0;l<r.length;l+=3){let s=r[l+0],i=r[l+1],c=r[l+2],u=n[3*s+0],h=n[3*s+1],m=n[3*s+2],x=a[2*s+0],f=a[2*s+1],p=n[3*i+0],_=n[3*i+1],d=n[3*i+2],E=a[2*i+0],T=a[2*i+1],b=p-u,A=_-h,g=d-m,S=n[3*c+0]-u,I=n[3*c+1]-h,w=n[3*c+2]-m,B=E-x,C=T-f,V=a[2*c+0]-x,U=a[2*c+1]-f,q=B*U-C*V,k=1/Math.abs(q<1e-4?1:q),G=(b*U-S*C)*k,Y=(A*U-I*C)*k,X=(g*U-w*C)*k,j=(S*B-b*V)*k,H=(I*B-A*V)*k,W=(w*B-g*V)*k,J=o[3*s+0],ee=o[3*s+1],te=o[3*s+2],ne=o[3*i+0],ce=o[3*i+1],le=o[3*i+2],ue=o[3*c+0],D=o[3*c+1],O=o[3*c+2],Dt=G*J+Y*ee+X*te,Nt=G*ne+Y*ce+X*le,Ot=G*ue+Y*D+X*O,Ut=G-J*Dt,zt=Y-ee*Dt,Vt=X-te*Dt,kt=G-ne*Nt,Gt=Y-ce*Nt,Yt=X-le*Nt,Xt=G-ue*Ot,jt=Y-D*Ot,$t=X-O*Ot,Ht=Math.sqrt(Ut*Ut+zt*zt+Vt*Vt),Wt=Math.sqrt(kt*kt+Gt*Gt+Yt*Yt),Kt=Math.sqrt(Xt*Xt+jt*jt+$t*$t),qt=j*J+H*ee+W*te,Zt=j*ne+H*ce+W*le,Qt=j*ue+H*D+W*O,Jt=j-J*qt,er=H-ee*qt,tr=W-te*qt,rr=j-ne*Zt,nr=H-ce*Zt,or=W-le*Zt,ar=j-ue*Qt,ir=H-D*Qt,sr=W-O*Qt,cr=Math.sqrt(Jt*Jt+er*er+tr*tr),lr=Math.sqrt(rr*rr+nr*nr+or*or),ur=Math.sqrt(ar*ar+ir*ir+sr*sr);t.tangents[3*s+0]+=Ut/Ht,t.tangents[3*s+1]+=zt/Ht,t.tangents[3*s+2]+=Vt/Ht,t.tangents[3*i+0]+=kt/Wt,t.tangents[3*i+1]+=Gt/Wt,t.tangents[3*i+2]+=Yt/Wt,t.tangents[3*c+0]+=Xt/Kt,t.tangents[3*c+1]+=jt/Kt,t.tangents[3*c+2]+=$t/Kt,t.bitangents[3*s+0]+=Jt/cr,t.bitangents[3*s+1]+=er/cr,t.bitangents[3*s+2]+=tr/cr,t.bitangents[3*i+0]+=rr/lr,t.bitangents[3*i+1]+=nr/lr,t.bitangents[3*i+2]+=or/lr,t.bitangents[3*c+0]+=ar/ur,t.bitangents[3*c+1]+=ir/ur,t.bitangents[3*c+2]+=sr/ur}this.tangents=t.tangents,this.bitangents=t.bitangents}makeBufferData(t){let r=this.vertices.length/3,n=new ArrayBuffer(t.stride*r);n.numItems=r;let o=new DataView(n);for(let a=0,l=0;a<r;a++){l=a*t.stride;for(let s of t.attributes){let i=l+t.attributeMap[s.key].offset;switch(s.key){case M.POSITION.key:o.setFloat32(i,this.vertices[3*a],!0),o.setFloat32(i+4,this.vertices[3*a+1],!0),o.setFloat32(i+8,this.vertices[3*a+2],!0);break;case M.UV.key:o.setFloat32(i,this.textures[2*a],!0),o.setFloat32(i+4,this.textures[2*a+1],!0);break;case M.NORMAL.key:o.setFloat32(i,this.vertexNormals[3*a],!0),o.setFloat32(i+4,this.vertexNormals[3*a+1],!0),o.setFloat32(i+8,this.vertexNormals[3*a+2],!0);break;case M.MATERIAL_INDEX.key:o.setInt16(i,this.vertexMaterialIndices[a],!0);break;case M.AMBIENT.key:{let c=this.vertexMaterialIndices[a],u=this.materialsByIndex[c];if(!u){console.warn('Material "'+this.materialNames[c]+'" not found in mesh. Did you forget to call addMaterialLibrary(...)?"');break}o.setFloat32(i,u.ambient[0],!0),o.setFloat32(i+4,u.ambient[1],!0),o.setFloat32(i+8,u.ambient[2],!0);break}case M.DIFFUSE.key:{let c=this.vertexMaterialIndices[a],u=this.materialsByIndex[c];if(!u){console.warn('Material "'+this.materialNames[c]+'" not found in mesh. Did you forget to call addMaterialLibrary(...)?"');break}o.setFloat32(i,u.diffuse[0],!0),o.setFloat32(i+4,u.diffuse[1],!0),o.setFloat32(i+8,u.diffuse[2],!0);break}case M.SPECULAR.key:{let c=this.vertexMaterialIndices[a],u=this.materialsByIndex[c];if(!u){console.warn('Material "'+this.materialNames[c]+'" not found in mesh. Did you forget to call addMaterialLibrary(...)?"');break}o.setFloat32(i,u.specular[0],!0),o.setFloat32(i+4,u.specular[1],!0),o.setFloat32(i+8,u.specular[2],!0);break}case M.SPECULAR_EXPONENT.key:{let c=this.vertexMaterialIndices[a],u=this.materialsByIndex[c];if(!u){console.warn('Material "'+this.materialNames[c]+'" not found in mesh. Did you forget to call addMaterialLibrary(...)?"');break}o.setFloat32(i,u.specularExponent,!0);break}case M.EMISSIVE.key:{let c=this.vertexMaterialIndices[a],u=this.materialsByIndex[c];if(!u){console.warn('Material "'+this.materialNames[c]+'" not found in mesh. Did you forget to call addMaterialLibrary(...)?"');break}o.setFloat32(i,u.emissive[0],!0),o.setFloat32(i+4,u.emissive[1],!0),o.setFloat32(i+8,u.emissive[2],!0);break}case M.TRANSMISSION_FILTER.key:{let c=this.vertexMaterialIndices[a],u=this.materialsByIndex[c];if(!u){console.warn('Material "'+this.materialNames[c]+'" not found in mesh. Did you forget to call addMaterialLibrary(...)?"');break}o.setFloat32(i,u.transmissionFilter[0],!0),o.setFloat32(i+4,u.transmissionFilter[1],!0),o.setFloat32(i+8,u.transmissionFilter[2],!0);break}case M.DISSOLVE.key:{let c=this.vertexMaterialIndices[a],u=this.materialsByIndex[c];if(!u){console.warn('Material "'+this.materialNames[c]+'" not found in mesh. Did you forget to call addMaterialLibrary(...)?"');break}o.setFloat32(i,u.dissolve,!0);break}case M.ILLUMINATION.key:{let c=this.vertexMaterialIndices[a],u=this.materialsByIndex[c];if(!u){console.warn('Material "'+this.materialNames[c]+'" not found in mesh. Did you forget to call addMaterialLibrary(...)?"');break}o.setInt16(i,u.illumination,!0);break}case M.REFRACTION_INDEX.key:{let c=this.vertexMaterialIndices[a],u=this.materialsByIndex[c];if(!u){console.warn('Material "'+this.materialNames[c]+'" not found in mesh. Did you forget to call addMaterialLibrary(...)?"');break}o.setFloat32(i,u.refractionIndex,!0);break}case M.SHARPNESS.key:{let c=this.vertexMaterialIndices[a],u=this.materialsByIndex[c];if(!u){console.warn('Material "'+this.materialNames[c]+'" not found in mesh. Did you forget to call addMaterialLibrary(...)?"');break}o.setFloat32(i,u.sharpness,!0);break}case M.ANTI_ALIASING.key:{let c=this.vertexMaterialIndices[a],u=this.materialsByIndex[c];if(!u){console.warn('Material "'+this.materialNames[c]+'" not found in mesh. Did you forget to call addMaterialLibrary(...)?"');break}o.setInt16(i,u.antiAliasing?1:0,!0);break}}}}return n}makeIndexBufferData(){let t=new Uint16Array(this.indices);return t.numItems=this.indices.length,t}makeIndexBufferDataForMaterials(...t){let r=new Array().concat(...t.map(o=>this.indicesPerMaterial[o])),n=new Uint16Array(r);return n.numItems=r.length,n}addMaterialLibrary(t){for(let r in t.materials){if(!(r in this.materialIndices))continue;let n=t.materials[r],o=this.materialIndices[n.name];this.materialsByIndex[o]=n}}};function*Vl(e){if(e.length<=3)yield e;else if(e.length===4)yield[e[0],e[1],e[2]],yield[e[2],e[3],e[0]];else for(let t=1;t<e.length-1;t++)yield[e[0],e[t],e[t+1]]}var ke=class{constructor(t){this.name=t,this.ambient=[0,0,0],this.diffuse=[0,0,0],this.specular=[0,0,0],this.emissive=[0,0,0],this.transmissionFilter=[0,0,0],this.dissolve=0,this.specularExponent=0,this.transparency=0,this.illumination=0,this.refractionIndex=1,this.sharpness=0,this.mapDiffuse={colorCorrection:!1,horizontalBlending:!0,verticalBlending:!0,boostMipMapSharpness:0,modifyTextureMap:{brightness:0,contrast:1},offset:{u:0,v:0,w:0},scale:{u:1,v:1,w:1},turbulence:{u:0,v:0,w:0},clamp:!1,textureResolution:null,bumpMultiplier:1,imfChan:null,filename:""},this.mapAmbient={colorCorrection:!1,horizontalBlending:!0,verticalBlending:!0,boostMipMapSharpness:0,modifyTextureMap:{brightness:0,contrast:1},offset:{u:0,v:0,w:0},scale:{u:1,v:1,w:1},turbulence:{u:0,v:0,w:0},clamp:!1,textureResolution:null,bumpMultiplier:1,imfChan:null,filename:""},this.mapSpecular={colorCorrection:!1,horizontalBlending:!0,verticalBlending:!0,boostMipMapSharpness:0,modifyTextureMap:{brightness:0,contrast:1},offset:{u:0,v:0,w:0},scale:{u:1,v:1,w:1},turbulence:{u:0,v:0,w:0},clamp:!1,textureResolution:null,bumpMultiplier:1,imfChan:null,filename:""},this.mapSpecularExponent={colorCorrection:!1,horizontalBlending:!0,verticalBlending:!0,boostMipMapSharpness:0,modifyTextureMap:{brightness:0,contrast:1},offset:{u:0,v:0,w:0},scale:{u:1,v:1,w:1},turbulence:{u:0,v:0,w:0},clamp:!1,textureResolution:null,bumpMultiplier:1,imfChan:null,filename:""},this.mapDissolve={colorCorrection:!1,horizontalBlending:!0,verticalBlending:!0,boostMipMapSharpness:0,modifyTextureMap:{brightness:0,contrast:1},offset:{u:0,v:0,w:0},scale:{u:1,v:1,w:1},turbulence:{u:0,v:0,w:0},clamp:!1,textureResolution:null,bumpMultiplier:1,imfChan:null,filename:""},this.antiAliasing=!1,this.mapBump={colorCorrection:!1,horizontalBlending:!0,verticalBlending:!0,boostMipMapSharpness:0,modifyTextureMap:{brightness:0,contrast:1},offset:{u:0,v:0,w:0},scale:{u:1,v:1,w:1},turbulence:{u:0,v:0,w:0},clamp:!1,textureResolution:null,bumpMultiplier:1,imfChan:null,filename:""},this.mapDisplacement={colorCorrection:!1,horizontalBlending:!0,verticalBlending:!0,boostMipMapSharpness:0,modifyTextureMap:{brightness:0,contrast:1},offset:{u:0,v:0,w:0},scale:{u:1,v:1,w:1},turbulence:{u:0,v:0,w:0},clamp:!1,textureResolution:null,bumpMultiplier:1,imfChan:null,filename:""},this.mapDecal={colorCorrection:!1,horizontalBlending:!0,verticalBlending:!0,boostMipMapSharpness:0,modifyTextureMap:{brightness:0,contrast:1},offset:{u:0,v:0,w:0},scale:{u:1,v:1,w:1},turbulence:{u:0,v:0,w:0},clamp:!1,textureResolution:null,bumpMultiplier:1,imfChan:null,filename:""},this.mapEmissive={colorCorrection:!1,horizontalBlending:!0,verticalBlending:!0,boostMipMapSharpness:0,modifyTextureMap:{brightness:0,contrast:1},offset:{u:0,v:0,w:0},scale:{u:1,v:1,w:1},turbulence:{u:0,v:0,w:0},clamp:!1,textureResolution:null,bumpMultiplier:1,imfChan:null,filename:""},this.mapReflections=[]}},Do=new ke("sentinel"),tt=class{constructor(t){this.data=t,this.currentMaterial=Do,this.materials={},this.parse()}parse_newmtl(t){let r=t[0];this.currentMaterial=new ke(r),this.materials[r]=this.currentMaterial}parseColor(t){if(t[0]=="spectral")throw new Error("The MTL parser does not support spectral curve files. You will need to convert the MTL colors to either RGB or CIEXYZ.");if(t[0]=="xyz")throw new Error("The MTL parser does not currently support XYZ colors. Either convert the XYZ values to RGB or create an issue to add support for XYZ");if(t.length==3){let[n,o,a]=t;return[parseFloat(n),parseFloat(o),parseFloat(a)]}let r=parseFloat(t[0]);return[r,r,r]}parse_Ka(t){this.currentMaterial.ambient=this.parseColor(t)}parse_Kd(t){this.currentMaterial.diffuse=this.parseColor(t)}parse_Ks(t){this.currentMaterial.specular=this.parseColor(t)}parse_Ke(t){this.currentMaterial.emissive=this.parseColor(t)}parse_Tf(t){this.currentMaterial.transmissionFilter=this.parseColor(t)}parse_d(t){this.currentMaterial.dissolve=parseFloat(t.pop()||"0")}parse_illum(t){this.currentMaterial.illumination=parseInt(t[0])}parse_Ni(t){this.currentMaterial.refractionIndex=parseFloat(t[0])}parse_Ns(t){this.currentMaterial.specularExponent=parseInt(t[0])}parse_sharpness(t){this.currentMaterial.sharpness=parseInt(t[0])}parse_cc(t,r){r.colorCorrection=t[0]=="on"}parse_blendu(t,r){r.horizontalBlending=t[0]=="on"}parse_blendv(t,r){r.verticalBlending=t[0]=="on"}parse_boost(t,r){r.boostMipMapSharpness=parseFloat(t[0])}parse_mm(t,r){r.modifyTextureMap.brightness=parseFloat(t[0]),r.modifyTextureMap.contrast=parseFloat(t[1])}parse_ost(t,r,n){for(;t.length<3;)t.push(n.toString());r.u=parseFloat(t[0]),r.v=parseFloat(t[1]),r.w=parseFloat(t[2])}parse_o(t,r){this.parse_ost(t,r.offset,0)}parse_s(t,r){this.parse_ost(t,r.scale,1)}parse_t(t,r){this.parse_ost(t,r.turbulence,0)}parse_texres(t,r){r.textureResolution=parseFloat(t[0])}parse_clamp(t,r){r.clamp=t[0]=="on"}parse_bm(t,r){r.bumpMultiplier=parseFloat(t[0])}parse_imfchan(t,r){r.imfChan=t[0]}parse_type(t,r){r.reflectionType=t[0]}parseOptions(t){let r={colorCorrection:!1,horizontalBlending:!0,verticalBlending:!0,boostMipMapSharpness:0,modifyTextureMap:{brightness:0,contrast:1},offset:{u:0,v:0,w:0},scale:{u:1,v:1,w:1},turbulence:{u:0,v:0,w:0},clamp:!1,textureResolution:null,bumpMultiplier:1,imfChan:null,filename:""},n,o,a={};for(t.reverse();t.length;){let l=t.pop();l.startsWith("-")?(n=l.substr(1),a[n]=[]):n&&a[n].push(l)}for(n in a){if(!a.hasOwnProperty(n))continue;o=a[n];let l=this[`parse_${n}`];l&&l.bind(this)(o,r)}return r}parseMap(t){let r,n="";t[0].startsWith("-")?(n=t.pop(),r=t):[n,...r]=t;let o=this.parseOptions(r);return o.filename=n.replace(/\\/g,"/"),o}parse_map_Ka(t){this.currentMaterial.mapAmbient=this.parseMap(t)}parse_map_Kd(t){this.currentMaterial.mapDiffuse=this.parseMap(t)}parse_map_Ks(t){this.currentMaterial.mapSpecular=this.parseMap(t)}parse_map_Ke(t){this.currentMaterial.mapEmissive=this.parseMap(t)}parse_map_Ns(t){this.currentMaterial.mapSpecularExponent=this.parseMap(t)}parse_map_d(t){this.currentMaterial.mapDissolve=this.parseMap(t)}parse_map_aat(t){this.currentMaterial.antiAliasing=t[0]=="on"}parse_map_bump(t){this.currentMaterial.mapBump=this.parseMap(t)}parse_bump(t){this.parse_map_bump(t)}parse_disp(t){this.currentMaterial.mapDisplacement=this.parseMap(t)}parse_decal(t){this.currentMaterial.mapDecal=this.parseMap(t)}parse_refl(t){this.currentMaterial.mapReflections.push(this.parseMap(t))}parse(){let t=this.data.split(/\r?\n/);for(let r of t){if(r=r.trim(),!r||r.startsWith("#"))continue;let[n,...o]=r.split(/\s/),a=this[`parse_${n}`];a?a.bind(this)(o):console.warn(`Don't know how to parse the directive: "${n}"`)}this.data="",this.currentMaterial=Do}};function kl(e,t){let r=["mapDiffuse","mapAmbient","mapSpecular","mapDissolve","mapBump","mapDisplacement","mapDecal","mapEmissive"];t.endsWith("/")||(t+="/");let n=[];for(let o in e.materials){if(!e.materials.hasOwnProperty(o))continue;let a=e.materials[o];for(let l of r){let s=a[l];if(!s||!s.filename)continue;let i=t+s.filename;n.push(fetch(i).then(c=>{if(!c.ok)throw new Error;return c.blob()}).then(function(c){let u=new Image;return u.src=URL.createObjectURL(c),s.texture=u,new Promise(h=>u.onload=h)}).catch(()=>{console.error(`Unable to download texture: ${i}`)}))}}return Promise.all(n)}function No(e){let t=[];for(let n of e){if(!n.obj)throw new Error('"obj" attribute of model object not set. The .obj file is required to be set in order to use downloadModels()');let o={indicesPerMaterial:!!n.indicesPerMaterial,calcTangentsAndBitangents:!!n.calcTangentsAndBitangents},a=n.name;if(!a){let u=n.obj.split("/");a=u[u.length-1].replace(".obj","")}let l=Promise.resolve(a),s=fetch(n.obj).then(u=>u.text()).then(u=>new Ve(u,o)),i;if(n.mtl){let u=typeof(r=n).mtl!="string"?r.obj.replace(/\.obj$/,".mtl"):r.mtl;i=fetch(u).then(h=>h.text()).then(h=>{let m=new tt(h);if(n.downloadMtlTextures!==!1){let x=n.mtlTextureRoot;return x||(x=u.substr(0,u.lastIndexOf("/"))),Promise.all([Promise.resolve(m),kl(m,x)])}return Promise.all([Promise.resolve(m),void 0])}).then(h=>h[0])}let c=[l,s,i];t.push(Promise.all(c))}var r;return Promise.all(t).then(n=>{let o={};for(let a of n){let[l,s,i]=a;s.name=l,i&&s.addMaterialLibrary(i),o[l]=s}return o})}function Oo(e,t,r){r===void 0&&(r={});let n=[];for(let o in e){if(!e.hasOwnProperty(o))continue;let a=e[o];n.push(fetch(a).then(l=>l.text()).then(l=>[o,new Ve(l)]))}Promise.all(n).then(o=>{for(let[a,l]of o)r[a]=l;return t(r)})}function wt(e,t,r,n){let o=e.createBuffer(),a=t===e.ARRAY_BUFFER?Float32Array:Uint16Array;return e.bindBuffer(t,o),e.bufferData(t,new a(r),e.STATIC_DRAW),o.itemSize=n,o.numItems=r.length/n,o}function Uo(e,t){return t.normalBuffer=wt(e,e.ARRAY_BUFFER,t.vertexNormals,3),t.textureBuffer=wt(e,e.ARRAY_BUFFER,t.textures,t.textureStride),t.vertexBuffer=wt(e,e.ARRAY_BUFFER,t.vertices,3),t.indexBuffer=wt(e,e.ELEMENT_ARRAY_BUFFER,t.indices,1),t}function zo(e,t){e.deleteBuffer(t.normalBuffer),e.deleteBuffer(t.textureBuffer),e.deleteBuffer(t.vertexBuffer),e.deleteBuffer(t.indexBuffer)}var Vo="2.0.3",Gl={Attribute:P,DuplicateAttributeException:et,Layout:M,Material:ke,MaterialLibrary:tt,Mesh:Ve,TYPES:R,downloadModels:No,downloadMeshes:Oo,initMeshBuffers:Uo,deleteMeshBuffers:zo,version:Vo},pu=re.ah,_u=re.i1,du=re.Ar,yu=re.F5,Eu=re.Jc,Tu=re.Kj,Au=re.NQ,bu=re.vK,gu=re.R9,Mu=re.Ml,ko=re.LT,vu=re.cP,wu=re.i8;function $(e){return e*Math.PI/180}var Go=$(-.5),Yo=$(-90);function St(e,t){e.cameraRotationXY[0]+=t[0],e.cameraRotationXY[1]+=t[1],e.cameraRotationXY[0]>Go?e.cameraRotationXY[0]=Go:e.cameraRotationXY[0]<Yo&&(e.cameraRotationXY[0]=Yo)}function Xo(e,t){let r=t[0]*Math.cos(-e.cameraRotationXY[1])-t[1]*Math.sin(-e.cameraRotationXY[1]),n=t[0]*Math.sin(-e.cameraRotationXY[1])+t[1]*Math.cos(-e.cameraRotationXY[1]);e.cameraViewing[0]+=r*e.cameraDistance/10,e.cameraViewing[2]+=n*e.cameraDistance/10}function sn(e,t){e.cameraDistance+=t,e.cameraDistance>100?e.cameraDistance=100:e.cameraDistance<4&&(e.cameraDistance=4)}function cn(e,t){let r={keyboard:{}};document.addEventListener("keydown",o=>{r.keyboard[o.code]=!0}),document.addEventListener("keyup",o=>{delete r.keyboard[o.code]}),e.addEventListener("contextmenu",o=>o.preventDefault()),e.addEventListener("mousedown",o=>{o.preventDefault(),!r.mousedown&&(r.mousedown=o.button===0?"left":"else",r.mouseCoord=[o.offsetX,o.offsetY])}),e.addEventListener("mouseup",()=>{r.mousedown&&!r.mousemove&&r.mousedown!=="left"||(r.mousedown=!1,r.mousemove=!1)}),e.addEventListener("touchstart",o=>{r.touched=!0,r.touchCoord=Ft(o.touches[0],e)}),e.addEventListener("touchend",o=>{o.preventDefault(),r.touched=!1,r.touchmove=!1,delete r.pitchSq}),e.addEventListener("mousemove",o=>{if(r.mousedown){let{offsetX:a,offsetY:l}=o,[s,i]=r.mouseCoord;(r.mousemove||(a-s)*(a-s)+(l-i)*(l-i)>48)&&(r.mousemove=!0,r.mousedown==="left"?Xo(t,[(s-a)/100,(i-l)/100]):St(t,[(i-l)/100,(s-a)/100]),r.mouseCoord=[a,l])}}),e.addEventListener("touchmove",o=>{if(!r.touched)return;let[a,l]=Xl(o.touches,e),[s,i]=r.touchCoord;if(r.touchCoord=[a,l],o.touches.length>=2){if(r.touchmove=!0,r.touched!=="multi")r.touched="multi";else if(St(t,[(i-l)/100,(s-a)/100]),o.touches.length===2){let c=[Ft(o.touches[0],e),Ft(o.touches[1],e)],u=(c[0][0]-c[1][0])*(c[0][0]-c[1][0])+(c[0][1]-c[1][1])*(c[0][1]-c[1][1]);if(r.pitchSq){let h=r.pitchSq;sn(t,(h-u)/2e3)}r.pitchSq=u}}else(r.touchmove||(a-s)*(a-s)+(l-i)*(l-i)>48)&&(r.touchmove=!0,Xo(t,[(s-a)/100,(i-l)/100]))});let n=navigator.platform.toUpperCase().indexOf("MAC")>=0;return e.addEventListener("wheel",o=>{if(o.preventDefault(),n){let s=Math.abs(o.deltaY);if(!r.touchpadDetected&&(s>0&&(r.wheelMinDeltaY=Math.min(s,r.wheelMinDeltaY||1/0)),r.wheelMinDeltaY)){let i=s/r.wheelMinDeltaY;(r.wheelMinDeltaY===1||i%1>0)&&(r.touchpadDetected=!0)}}let a=0,l=[0,0];o.ctrlKey?a+=o.deltaY/2:r.touchpadDetected?(l[0]+=o.deltaY/200,l[1]+=o.deltaX/200):(a+=o.deltaY/50,l[1]+=o.deltaX/100),sn(t,a),St(t,l)}),e.addEventListener("gesturestart",o=>{o.preventDefault(),r.gestureRotation=o.rotation,r.gestureScale=o.scale}),e.addEventListener("gesturechange",o=>{if(o.preventDefault(),r.touched)return;let a=r.gestureRotation,l=r.gestureScale;r.gestureRotation=o.rotation,r.gestureScale=o.scale,St(t,[0,$(r.gestureRotation-a)]),sn(t,(l-r.gestureScale)*20)}),r}function Ft(e,t){return[e.pageX-t.offsetLeft,e.pageY-t.offsetTop]}function Xl(e,t){return Array(e.length).fill().map((r,n)=>Ft(e[n],t)).reduce(([r,n],[o,a])=>[r+o,n+a],[0,0]).map(r=>r/e.length)}var y={multiply:(e,t,...r)=>{let n=[t[0]*e[0]+t[1]*e[4]+t[2]*e[8]+t[3]*e[12],t[0]*e[1]+t[1]*e[5]+t[2]*e[9]+t[3]*e[13],t[0]*e[2]+t[1]*e[6]+t[2]*e[10]+t[3]*e[14],t[0]*e[3]+t[1]*e[7]+t[2]*e[11]+t[3]*e[15],t[4]*e[0]+t[5]*e[4]+t[6]*e[8]+t[7]*e[12],t[4]*e[1]+t[5]*e[5]+t[6]*e[9]+t[7]*e[13],t[4]*e[2]+t[5]*e[6]+t[6]*e[10]+t[7]*e[14],t[4]*e[3]+t[5]*e[7]+t[6]*e[11]+t[7]*e[15],t[8]*e[0]+t[9]*e[4]+t[10]*e[8]+t[11]*e[12],t[8]*e[1]+t[9]*e[5]+t[10]*e[9]+t[11]*e[13],t[8]*e[2]+t[9]*e[6]+t[10]*e[10]+t[11]*e[14],t[8]*e[3]+t[9]*e[7]+t[10]*e[11]+t[11]*e[15],t[12]*e[0]+t[13]*e[4]+t[14]*e[8]+t[15]*e[12],t[12]*e[1]+t[13]*e[5]+t[14]*e[9]+t[15]*e[13],t[12]*e[2]+t[13]*e[6]+t[14]*e[10]+t[15]*e[14],t[12]*e[3]+t[13]*e[7]+t[14]*e[11]+t[15]*e[15]];return r.length===0?n:y.multiply(n,...r)},identity:()=>[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],projection:(e,t,r)=>[2/e,0,0,0,0,-2/t,0,0,0,0,2/r,0,-1,1,0,1],perspective:(e,t,r,n)=>{let o=1/Math.tan(e/2),a=1/(r-n);return[o/t,0,0,0,0,o,0,0,0,0,(r+n)*a,-1,0,0,n*r*a*2,0]},translate:(e,t,r)=>[1,0,0,0,0,1,0,0,0,0,1,0,e,t,r,1],scale:(e,t,r)=>[e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1],xRotate:e=>{let t=Math.cos(e),r=Math.sin(e);return[1,0,0,0,0,t,r,0,0,-r,t,0,0,0,0,1]},yRotate:e=>{let t=Math.cos(e),r=Math.sin(e);return[t,0,-r,0,0,1,0,0,r,0,t,0,0,0,0,1]},zRotate:e=>{let t=Math.cos(e),r=Math.sin(e);return[t,r,0,0,-r,t,0,0,0,0,1,0,0,0,0,1]},lookAt:(e,t,r)=>{let n=y.normalize(y.subtractVectors(e,t)),o=y.normalize(y.cross(r,n)),a=y.normalize(y.cross(n,o));return[o[0],o[1],o[2],0,a[0],a[1],a[2],0,n[0],n[1],n[2],0,e[0],e[1],e[2],1]},subtractVectors:(e,t)=>[e[0]-t[0],e[1]-t[1],e[2]-t[2]],cross:(e,t)=>[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]],normalize:e=>{let t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return t>1e-5?[e[0]/t,e[1]/t,e[2]/t]:[0,0,0]},transpose:e=>[e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]],inverse:e=>{let t=e[0],r=e[0*4+1],n=e[0*4+2],o=e[0*4+3],a=e[1*4+0],l=e[1*4+1],s=e[1*4+2],i=e[1*4+3],c=e[2*4+0],u=e[2*4+1],h=e[2*4+2],m=e[2*4+3],x=e[3*4+0],f=e[3*4+1],p=e[3*4+2],_=e[3*4+3],d=h*_,E=p*m,T=s*_,b=p*i,A=s*m,g=h*i,S=n*_,I=p*o,w=n*m,B=h*o,C=n*i,V=s*o,U=c*f,q=x*u,k=a*f,G=x*l,Y=a*u,X=c*l,j=t*f,H=x*r,W=t*u,J=c*r,ee=t*l,te=a*r,ne=d*l+b*u+A*f-(E*l+T*u+g*f),ce=E*r+S*u+B*f-(d*r+I*u+w*f),le=T*r+I*l+C*f-(b*r+S*l+V*f),ue=g*r+w*l+V*u-(A*r+B*l+C*u),D=1/(t*ne+a*ce+c*le+x*ue);return[D*ne,D*ce,D*le,D*ue,D*(E*a+T*c+g*x-(d*a+b*c+A*x)),D*(d*t+I*c+w*x-(E*t+S*c+B*x)),D*(b*t+S*a+V*x-(T*t+I*a+C*x)),D*(A*t+B*a+C*c-(g*t+w*a+V*c)),D*(U*i+G*m+Y*_-(q*i+k*m+X*_)),D*(q*o+j*m+J*_-(U*o+H*m+W*_)),D*(k*o+H*i+ee*_-(G*o+j*i+te*_)),D*(X*o+W*i+te*m-(Y*o+J*i+ee*m)),D*(k*h+X*p+q*s-(Y*p+U*s+G*h)),D*(W*p+U*n+H*h-(j*h+J*p+q*n)),D*(j*s+te*p+G*n-(ee*p+k*n+H*s)),D*(ee*h+Y*n+J*s-(W*s+te*h+X*n))]},log:e=>{console.group(),console.log(e.slice(0,4)),console.log(e.slice(4,8)),console.log(e.slice(8,12)),console.log(e.slice(12)),console.groupEnd()}};var he=96,Ct=3,Me=[he,he*Ct],jo=.05,$o=25e-5,Ho=$(20),jl=2e-5,It=[.5,.5,2.75,1.4],un=128,$l=un-1,Rt=`
attribute vec4 a_position;
attribute vec2 a_texcoord;
attribute vec3 a_normal;

uniform mat4 u_matrix;
uniform mat4 u_worldMatrix;
uniform mat4 u_normalMatrix;
uniform vec3 u_worldViewerPosition;
uniform mat4 u_reflectionMatrix;
uniform mat4 u_lightProjectionMatrix;

varying vec2 v_texcoord;
varying vec3 v_surfaceToViewer;
varying mat3 v_normalMatrix;
varying vec4 v_reflectionTexcoord;
varying float v_depth;
varying vec4 v_lightProjection;
varying vec4 v_worldPosition;

void main() {
  gl_Position = u_matrix * a_position;
  v_texcoord = vec2(a_texcoord.x, 1.0 - a_texcoord.y);

  vec3 normal = mat3(u_normalMatrix) * a_normal;
  vec3 normalMatrixI = normal.y >= 1.0 ?
    vec3(1, 0, 0) :
    normalize(cross(vec3(0, 1, 0), normal));
  vec3 normalMatrixJ = normalize(cross(normal, normalMatrixI));

  v_normalMatrix = mat3(
    normalMatrixI,
    normalMatrixJ,
    normal
  );

  v_worldPosition = u_worldMatrix * a_position;
  v_surfaceToViewer = u_worldViewerPosition - v_worldPosition.xyz;

  v_reflectionTexcoord = u_reflectionMatrix * v_worldPosition;

  v_depth = gl_Position.z / gl_Position.w * 0.5 + 0.5;
  v_lightProjection = u_lightProjectionMatrix * v_worldPosition;
}
`,Wo=`
precision highp float;

varying vec2 v_texcoord;
varying vec3 v_surfaceToViewer;
varying vec3 v_surfaceToLight;
varying mat3 v_normalMatrix;
varying vec4 v_lightProjection;
varying vec4 v_worldPosition;

uniform sampler2D u_normalMap;
uniform vec3 u_diffuse;
uniform sampler2D u_diffuseMap;
uniform vec3 u_lightDir;
uniform vec3 u_specular;
uniform float u_specularExponent;
uniform vec3 u_emissive;
uniform vec3 u_ambient;
uniform sampler2D u_lightProjectionMap;

void main() {
  vec3 normal = texture2D(u_normalMap, v_texcoord).xyz * 2.0 - 1.0;
  normal = normalize(v_normalMatrix * normal);

  vec2 lightProjectionCoord = v_lightProjection.xy / v_lightProjection.w * 0.5 + 0.5;
  float lightToSurfaceDepth = v_lightProjection.z / v_lightProjection.w * 0.5 + 0.5;
  float lightProjectedDepth = texture2D(
    u_lightProjectionMap,
    lightProjectionCoord
  ).r;

  vec3 diffuse = u_diffuse + texture2D(u_diffuseMap, v_texcoord).rgb;

  vec3 surfaceToLightDir = normalize(-u_lightDir);

  float diffuseLight = clamp(dot(surfaceToLightDir, normal), 0.0, 1.0);

  vec3 surfaceToViewerDirection = normalize(v_surfaceToViewer);

  vec3 halfVector = normalize(surfaceToLightDir + surfaceToViewerDirection);
  float specularBrightness = pow(
    clamp(dot(halfVector, normal), 0.0, 1.0), u_specularExponent
  );

  float occlusion = smoothstep(0.01, 0.1, lightToSurfaceDepth - lightProjectedDepth);

  diffuseLight *= 1.0 - occlusion;
  specularBrightness *= 1.0 - clamp(occlusion * 2.0, 0.0, 1.0);

  vec3 ambient = u_ambient * diffuse;

  gl_FragColor = vec4(
    clamp(
      diffuse * diffuseLight +
      u_specular * specularBrightness +
      u_emissive,
      ambient, vec3(1, 1, 1)
    ),
    v_worldPosition.y < -0.1 ? 0 : 1
  );
}
`,Hl=`
precision highp float;

varying float v_depth;

void main() {
  gl_FragColor = vec4(v_depth, v_depth, v_depth, 1);
}
`,Wl=`
precision highp float;

varying vec2 v_texcoord;
varying vec3 v_surfaceToViewer;
varying vec3 v_surfaceToLight;
varying mat3 v_normalMatrix;
varying vec4 v_reflectionTexcoord;
varying vec4 v_lightProjection;
varying vec4 v_worldPosition;

uniform vec3 u_diffuse;
uniform sampler2D u_diffuseMap;
uniform vec3 u_lightDir;
uniform vec3 u_specular;
uniform float u_specularExponent;
uniform vec3 u_emissive;
uniform vec3 u_ambient;
uniform sampler2D u_lightProjectionMap;
uniform float u_time;
uniform float u_windStrength;

vec3 oceanNormal(vec2 pos);

void main() {
  vec2 texcoord = (v_reflectionTexcoord.xy / v_reflectionTexcoord.w) * 0.5 + 0.5;
  vec3 normal = oceanNormal(v_worldPosition.xz);
  vec2 distortion = normalize(normal).xy;
  normal = normalize(v_normalMatrix * normal);

  vec2 lightProjectionCoord = v_lightProjection.xy / v_lightProjection.w * 0.5 + 0.5;
  float lightToSurfaceDepth = v_lightProjection.z / v_lightProjection.w * 0.5 + 0.5;
  float lightProjectedDepth = texture2D(
    u_lightProjectionMap,
    lightProjectionCoord + distortion * 0.01
  ).r;

  vec3 diffuse = u_diffuse + texture2D(
    u_diffuseMap,
    texcoord + distortion * 0.1
  ).rgb;

  vec3 surfaceToLightDir = normalize(-u_lightDir);

  float diffuseLight = clamp(dot(surfaceToLightDir, normal), 0.0, 1.0);

  vec3 surfaceToViewerDirection = normalize(v_surfaceToViewer);

  vec3 halfVector = normalize(surfaceToLightDir + surfaceToViewerDirection);
  float specularBrightness = pow(
    clamp(dot(halfVector, normal), 0.0, 1.0), u_specularExponent
  );

  float occlusion = smoothstep(0.01, 0.1, lightToSurfaceDepth - lightProjectedDepth);

  diffuseLight *= 1.0 - occlusion;
  specularBrightness *= 1.0 - clamp(occlusion * 2.0, 0.0, 1.0);

  vec3 ambient = u_ambient * diffuse;

  gl_FragColor = vec4(
    clamp(
      diffuse * diffuseLight +
      u_specular * specularBrightness +
      u_emissive,
      ambient, vec3(1, 1, 1)
    ),
    1
  );
}

float hash(vec2 p) {
  return fract(sin(mod(dot(p, vec2(13, 17)), radians(180.0))) * 4801.0);
}

float localWaveHeight(vec2 id, vec2 position) {
  float directionRad = radians((hash(id) - 0.5) * 45.0 + 90.0);
  vec2 direction = vec2(cos(directionRad), sin(directionRad));

  float distance = length(id + 0.5 - position);
  float strength = smoothstep(1.5, 0.0, distance);

  float waveX = dot(position, direction) * 2.5 + u_time * 5.0;
  return exp(sin(waveX) - 1.0) * strength;
}

vec3 oceanSurfacePosition(vec2 position) {
  position *= 6.2;
  vec2 id = floor(position);

  float height = 0.0;

  for (int i = -1; i <= 1; i++) {
    for (int j = -1; j <= 1; j++) {
      height += localWaveHeight(id + vec2(i, j), position);
    }
  }

  height *= u_windStrength;

  return vec3(position, height);
}

#define OCEAN_SAMPLE_DISTANCE 0.01
vec3 oceanNormal(vec2 position) {
  vec3 p1 = oceanSurfacePosition(position);
  vec3 p2 = oceanSurfacePosition(position + vec2(OCEAN_SAMPLE_DISTANCE, 0));
  vec3 p3 = oceanSurfacePosition(position + vec2(0, OCEAN_SAMPLE_DISTANCE));

  return normalize(cross(
    normalize(p2 - p1), normalize(p3 - p1)
  ));
}
`,Kl=`
precision highp float;

varying vec2 v_texcoord;

uniform vec4 u_bgColor;
uniform sampler2D u_texture;

void main() {
  gl_FragColor = u_bgColor + texture2D(u_texture, v_texcoord);
}
`,Ko=`
attribute vec2 a_position;
uniform mat4 u_matrix;

varying vec2 v_position;
varying vec3 v_normal;

void main() {
  gl_Position = vec4(a_position, 1, 1);
  v_position = a_position;
  v_normal = (u_matrix * gl_Position).xyz;
}
`,ql=`
precision highp float;

varying vec3 v_normal;

uniform samplerCube u_skyboxMap;

void main() {
  gl_FragColor = textureCube(u_skyboxMap, normalize(v_normal));
}
`,Zl=`
precision highp float;

varying vec2 v_position;

uniform float u_seed;
uniform vec2 u_landMapSize;
uniform vec2 u_landMapOffset;

float landAltitude(vec2 location);
vec3 packFloatToRgb(float value);

void main() {
  vec2 location = v_position * u_landMapSize * vec2(0.5, -0.5) + u_landMapOffset;
  float altitude = landAltitude(location);

  gl_FragColor = vec4(packFloatToRgb(altitude), 1);
}

float hash0(vec2 p) {
  return fract(sin(mod(dot(p, vec2(101, 107)), radians(180.0))) * u_seed);
}
float hash1(vec2 p) {
  return fract(sin(mod(dot(p, vec2(113, 127)), radians(180.0))) * u_seed);
}
float hash2(vec2 p) {
  return fract(sin(mod(dot(p, vec2(179, 181)), radians(180.0))) * u_seed);
}

float island(vec2 loc, vec2 origin, float size) {
  return log(max((size - length(loc - origin)) * 0.35, 0.01));
}
float localLandAltitude(vec2 loc, vec2 id) {
  if (id.y >= 2.0 || id.y >= -2.0 && id.x <= 0.0 && id.x >= -1.0) return -1.0;

  vec2 origin = id * 16.0 + vec2(8, 8) + (vec2(hash0(id), hash1(id)) - 0.5) * 10.0;
  float size = hash2(id) * 2.0 + abs(id.x + 0.5) * 1.2 + 4.0;

  return island(loc, origin, size);
}

float landAltitude(vec2 loc) {
  float altitude = -1.0;

  vec2 id = floor(loc * 0.0625);

  for (int i = -1; i <= 1; i++) {
    for (int j = -1; j <= 1; j++) {
      altitude = max(altitude, localLandAltitude(loc, id + vec2(i, j)));
    }
  }

  altitude = max(altitude, log(max(clamp(loc.y * -0.375 - 3.0, 0.0, 3.0) - abs(loc.x + cos(loc.y) - 45.0), 0.01)));
  altitude = max(altitude, log(max(clamp(loc.y * -0.375 - 3.0, 0.0, 3.0) - abs(loc.x + cos(loc.y) + 45.0), 0.01)));

  return altitude;
}

vec3 packFloatToRgb(float value) {
  value += ${un.toFixed(2)};
  float r = floor(value);
  value -= r;
  float g = floor(value * 256.0);
  value -= g / 256.0;
  float b = floor(value * 256.0 * 256.0);
  return vec3(r, g, b) / 255.0;
}
`,Ql=`
attribute vec4 a_position;
attribute vec2 a_texcoord;
attribute vec3 a_normal;

uniform mat4 u_matrix;
uniform mat4 u_worldMatrix;
uniform mat4 u_normalMatrix;
uniform vec3 u_worldViewerPosition;
uniform mat4 u_lightProjectionMatrix;
uniform sampler2D u_landMap;
uniform vec2 u_landMapSize;
uniform vec2 u_landMapOffset;
uniform vec2 u_landOffset;
uniform float u_landFarthest;

varying vec2 v_texcoord;
varying vec3 v_surfaceToViewer;
varying mat3 v_normalMatrix;
varying vec4 v_lightProjection;
varying vec4 v_worldPosition;

float unpackRgbToFloat(vec3 rgb) {
  float value = rgb.r * 255.0 + rgb.g + rgb.b / 255.0;
  return value - ${un.toFixed(2)};
}

vec3 getAltitudePosition(vec4 pos) {
  vec2 location = pos.xz + u_landOffset;

  vec4 packedAltitude = texture2D(
    u_landMap,
    (location - u_landMapOffset) / u_landMapSize * vec2(1, -1) + vec2(0.5, 0.5)
  );
  float altitude = unpackRgbToFloat(packedAltitude.rgb);

  altitude = min(altitude, location.y * 0.333333 + u_landFarthest * -0.333333 - 1.0);

  return vec3(location.x, altitude, location.y);
}

#define LAND_SAMPLE_DISTANCE 0.5
void main() {
  vec4 position = vec4(getAltitudePosition(a_position), 1);
  gl_Position = u_matrix * position;
  v_texcoord = vec2(a_texcoord.x, 1.0 - a_texcoord.y);

  vec3 p2 = getAltitudePosition(a_position + vec4(0, 0, LAND_SAMPLE_DISTANCE, 0));
  vec3 p3 = getAltitudePosition(a_position + vec4(LAND_SAMPLE_DISTANCE, 0, 0, 0));
  vec3 landNormal = normalize(cross(
    normalize(p2 - position.xyz), normalize(p3 - position.xyz)
  ));

  vec3 normal = mat3(u_normalMatrix) * landNormal;
  vec3 normalMatrixI = normal.y >= 1.0 ?
    vec3(1, 0, 0) :
    normalize(cross(vec3(0, 1, 0), normal));
  vec3 normalMatrixJ = normalize(cross(normal, normalMatrixI));

  v_normalMatrix = mat3(
    normalMatrixI,
    normalMatrixJ,
    normal
  );

  v_worldPosition = u_worldMatrix * position;
  v_surfaceToViewer = u_worldViewerPosition - v_worldPosition.xyz;
  v_lightProjection = u_lightProjectionMatrix * v_worldPosition;
}
`;function Jl(){return ve(this,null,function*(){let t=document.getElementById("canvas").getContext("webgl"),r=t.getExtension("OES_vertex_array_object");if(r)t.createVertexArray=(...c)=>r.createVertexArrayOES(...c),t.deleteVertexArray=(...c)=>r.deleteVertexArrayOES(...c),t.isVertexArray=(...c)=>r.isVertexArrayOES(...c),t.bindVertexArray=(...c)=>r.bindVertexArrayOES(...c);else throw new Error("Your browser does not support WebGL ext: OES_vertex_array_object");if(!t.getExtension("WEBGL_depth_texture"))throw new Error("Your browser does not support WebGL ext: WEBGL_depth_texture");Fn("a_");let o={main:be(t,[Rt,Wo]),depth:be(t,[Rt,Hl]),ocean:be(t,[Rt,Wl]),land:be(t,[Ql,Wo]),text:be(t,[Rt,Kl]),skybox:be(t,[Ko,ql]),landMap:be(t,[Ko,Zl])},a=qn(t,{scale:{src:"/assets/scale_diffuse.webp",min:t.LINEAR_MIPMAP_LINEAR,mag:t.LINEAR},scaleNormal:{src:"/assets/scale_normal.webp",min:t.LINEAR_MIPMAP_LINEAR,mag:t.LINEAR},skybox:{target:t.TEXTURE_CUBE_MAP,src:["/assets/skybox/east.webp","/assets/skybox/west.webp","/assets/skybox/up.webp","/assets/skybox/down.webp","/assets/skybox/north.webp","/assets/skybox/south.webp"]},null:{src:[0,0,0,255]},nullNormal:{src:[127,127,255,255]}}),l=tu();a.text=Qo(t,l);let s={};s.reflection=vt(t,null,2048,2048),a.reflection=s.reflection.attachments[0],s.lightProjection=vt(t,[{attachmentPoint:t.DEPTH_ATTACHMENT,internalFormat:t.DEPTH_COMPONENT32F,format:t.DEPTH_COMPONENT,minMag:t.NEAREST}],2048,2048),a.lightProjection=s.lightProjection.attachments[0],s.landMap=vt(t,[{minMag:t.NEAREST}],Me[0]*8,Me[1]*8),a.landMap=s.landMap.attachments[0];let i={};{let c=qe.createSphereVertices(1,32,32),u=ye(t,c),h=ze(t,o.main,u);i.sphere={vertexDataArrays:c,vao:h,bufferInfo:u}}{let c=qe.createPlaneVertices(),u=ye(t,c),h=ze(t,o.main,u);i.plane={vertexDataArrays:c,vao:h,bufferInfo:u}}{let c=qe.createXYQuadVertices(),u=ye(t,c),h=ze(t,o.skybox,u);i.xyQuad={attribs:c,bufferInfo:u,vao:h}}{let c=qe.createPlaneVertices(he,he,he*2,he*2),u=ye(t,c),h=ze(t,o.land,u);i.land={vertexDataArrays:c,bufferInfo:u,vao:h}}return i.sailboat=yield eu(t,a,o.main),t.enable(t.CULL_FACE),t.enable(t.DEPTH_TEST),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.clearColor(0,0,0,1),{gl:t,programInfos:o,textures:a,framebuffers:s,objects:i,time:0}})}function eu(e,t,r){return ve(this,null,function*(){let{boatModel:n}=yield ko([{name:"boatModel",obj:"/assets/sailboat.obj",mtl:!0}]),o=ye(e,{position:{numComponents:3,data:n.vertices},texcoord:{numComponents:2,data:n.textures},normal:{numComponents:3,data:n.vertexNormals}});return n.indicesPerMaterial.map((l,s)=>{let i=n.materialsByIndex[s],c=ye(e,{indices:l},o),u=t.null;return i.mapDiffuse.texture&&(u=pt(e,{wrapS:e.CLAMP_TO_EDGE,wrapT:e.CLAMP_TO_EDGE,min:e.LINEAR_MIPMAP_LINEAR,src:i.mapDiffuse.texture})),{name:i.name,bufferInfo:c,vao:ze(e,r,c),uniforms:{u_diffuse:i.diffuse,u_diffuseMap:u,u_specular:i.specular,u_specularExponent:i.specularExponent,u_emissive:i.emissive,u_ambient:[.6,.6,.6]}}})})}function Qo(e,t){let r=e.createTexture();return e.bindTexture(e.TEXTURE_2D,r),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),e.generateMipmap(e.TEXTURE_2D),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,!1),r}function tu(){let e=document.createElement("canvas");e.width=1024,e.height=1024;let t=e.getContext("2d");t.fillStyle="white",t.textAlign="center",t.textBaseline="middle",t.font="bold 100px serif",t.fillText("Catch The Wind!",e.width/2,e.height/5);let r=3*e.height/5,n=e.height/7;return t.font="bold 70px serif",t.fillText("\u6309\u4E0B\u4E0B\u65B9\u6309\u9215\u6216\u9375\u76E4\u65B9\u5411\u9375",e.width/2,r-n),t.fillText("\u6253\u958B\u98A8\u5E06\u5F80\u5DE6/\u53F3\u524D\u65B9\u822A\u884C",e.width/2,r),t.fillText("\u6CE8\u610F\u4E0D\u8981\u649E\u5230\u9678\u5730",e.width/2,r+n),t.font="bold 60px serif",t.fillText("(WebGL1 \u7248\u672C)",e.width/2,r+n*2),e}function ru(e){let t=document.createElement("canvas");t.width=1024,t.height=1024;let r=t.getContext("2d");r.fillStyle="white",r.textAlign="center",r.textBaseline="middle",r.font="bold 100px serif",r.fillText("Game Over",t.width/2,t.height/5);let n=2*t.height/3,o=t.height/8;return r.font="bold 70px serif",r.fillText("\u649E\u4E86\uFF0C\u4F60\u7684\u5206\u6578\uFF1A",t.width/2,n-o*2),r.fillText("\u53EF\u5229\u7528\u6ED1\u9F20\u3001\u89F8\u63A7\u79FB\u52D5\u8996\u89D2",t.width/2,n),r.fillText("\u6216\u662F\u91CD\u65B0\u6574\u7406\u518D\u4F86\u4E00\u5C40",t.width/2,n+o),r.font="bold 90px serif",r.fillText(e.state.score,t.width/2,n-o),t}function ln(e,t,r){let{gl:n,textures:o,objects:a,state:l,time:s}=e,i=y.multiply(y.translate(l.sailboatLocation[0],0,l.sailboatLocation[1]),y.xRotate(Math.sin(s*.0011)*.03+.03+l.sailboatRotationX),y.translate(0,Math.sin(s*.0017)*.05+l.sailboatTranslateY,0)),c=y.multiply(i,y.translate(0,l.sailTranslateY,0),y.scale(l.sailScaleX,l.sailScaleY,1)),u=y.multiply(i,y.scale(l.sailFrontScaleXY*l.sailScaleX,l.sailFrontScaleXY,1)),h={u_matrix:y.multiply(t,i),u_worldMatrix:i,u_normalMatrix:y.transpose(y.inverse(i)),u_normalMap:o.nullNormal},m={u_matrix:y.multiply(t,c),u_worldMatrix:c,u_normalMatrix:y.transpose(y.inverse(c))},x={u_matrix:y.multiply(t,u),u_worldMatrix:u,u_normalMatrix:y.transpose(y.inverse(u))};n.disable(n.CULL_FACE),a.sailboat.forEach(({name:f,bufferInfo:p,vao:_,uniforms:d})=>{n.bindVertexArray(_),ae(r,Ge(Ge(Ge(Ge({},h),f==="sails"&&m),f==="sails-front"&&x),d)),Ce(n,p)}),n.enable(n.CULL_FACE)}function qo(e,t,r,n){let{gl:o,textures:a,objects:l,state:s}=e;o.bindVertexArray(l.plane.vao);let i=y.multiply(y.translate(s.sailboatLocation[0],0,s.sailboatLocation[1]),y.scale(4e3,1,4e3));ae(n,{u_matrix:y.multiply(t,i),u_worldMatrix:i,u_normalMatrix:y.transpose(y.inverse(i)),u_diffuse:[0,0,0],u_diffuseMap:a.reflection,u_specularExponent:200,u_emissive:[0,0,0],u_ambient:[.4,.4,.4],u_reflectionMatrix:r,u_windStrength:s.windStrength}),Ce(o,l.plane.bufferInfo)}function nu(e,t,r){let{gl:n,textures:o,objects:a,state:l}=e;n.bindVertexArray(a.land.vao);let s=y.identity();ae(r,{u_matrix:y.multiply(t,s),u_worldMatrix:s,u_normalMatrix:y.transpose(y.inverse(s)),u_diffuse:[.97265625,.9140625,.62890625],u_diffuseMap:o.null,u_emissive:[0,0,0],u_specular:[0,0,0],u_normalMap:o.nullNormal,u_landMap:o.landMap,u_landMapSize:Me,u_landMapOffset:Lt(e),u_landFarthest:l.sailboatLocation[1]-he*(Ct-1.5)});for(let i=0;i<Ct;i++)ae(r,{u_landOffset:[0,-he*(l.level+i)]}),Ce(n,a.land.bufferInfo)}function Zo(e,t,r){let{gl:n,programInfos:o,objects:a,textures:l}=e;n.bindVertexArray(a.xyQuad.vao),ae(o.skybox,{u_skyboxMap:l.skybox,u_matrix:y.inverse(y.multiply(t,[...r.slice(0,12),0,0,0,r[15]]))}),n.depthFunc(n.LEQUAL),Ce(n,a.xyQuad.bufferInfo),n.depthFunc(n.LESS)}function ou(e,t,r){let{gl:n,textures:o,objects:a}=e;n.bindVertexArray(a.plane.vao);let l=n.canvas.width/n.canvas.height<1.4?0:-1.6,s=e.state.gameOver?y.multiply(y.translate(e.state.sailboatLocation[0],0,e.state.sailboatLocation[1]),y.xRotate($(75)),y.translate(0,22.5,0)):y.multiply(y.translate(l,0,0),y.yRotate($(135)),y.xRotate($(75)),y.translate(0,12.5,0));ae(r,{u_matrix:y.multiply(t,s),u_bgColor:[0,0,0,.2],u_texture:o.text}),Ce(n,a.plane.bufferInfo)}function au(e){let{gl:t,programInfos:r,framebuffers:n,textures:o,state:a,time:l}=e,s=y.multiply(y.translate(...a.cameraViewing),y.yRotate(a.cameraRotationXY[1]),y.xRotate(a.cameraRotationXY[0]),y.translate(0,0,a.cameraDistance)),i=y.perspective(a.fieldOfView,t.canvas.width/t.canvas.height,.1,2e3),c=y.inverse(s),u=y.multiply(i,c),h=y.multiply(y.translate(...a.cameraViewing),y.yRotate(a.cameraRotationXY[1]),y.xRotate(-a.cameraRotationXY[0]),y.translate(0,0,a.cameraDistance)),m=y.inverse(h),x=y.multiply(i,m),f=y.multiply(y.translate(1,-1,0),y.projection(20,20,10),[1,0,0,0,0,1,0,0,0,Math.tan(a.lightRotationXY[0]),1,0,0,0,0,1],y.inverse(y.multiply(y.translate(a.sailboatLocation[0],0,a.sailboatLocation[1]),y.yRotate(a.lightRotationXY[1]),y.xRotate($(90))))),p={u_worldViewerPosition:s.slice(12,15),u_lightDir:[-1*Math.sin(a.lightRotationXY[0])*Math.sin(a.lightRotationXY[1]),-1*Math.cos(a.lightRotationXY[0]),-1*Math.sin(a.lightRotationXY[0])*Math.cos(a.lightRotationXY[1])],u_specular:[1,1,1],u_lightProjectionMatrix:f,u_lightProjectionMap:o.lightProjection,u_time:l*.001};Je(t,n.lightProjection),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.useProgram(r.depth.program),qo(e,f,x,r.depth),ln(e,f,r.depth),Je(t,n.reflection),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),t.useProgram(r.skybox.program),Zo(e,i,m),t.useProgram(r.main.program),ae(r.main,p),ln(e,x,r.main),t.bindFramebuffer(t.FRAMEBUFFER,null),Lo(t.canvas,a.resolutionRatio),t.viewport(0,0,canvas.width,canvas.height),t.useProgram(r.main.program),ln(e,u,r.main),t.useProgram(r.ocean.program),ae(r.ocean,p),qo(e,u,x,r.ocean),t.useProgram(r.land.program),ae(r.land,p),nu(e,u,r.land),t.useProgram(r.skybox.program),Zo(e,i,c),t.useProgram(r.text.program),ou(e,u,r.text)}function Jo(e){let{gl:t,programInfos:r,framebuffers:n,objects:o,state:a}=e;t.useProgram(r.landMap.program),Je(t,n.landMap),t.bindVertexArray(o.xyQuad.vao),ae(r.landMap,{u_seed:a.seed,u_landMapSize:Me,u_landMapOffset:Lt(e)}),Ce(t,o.xyQuad.bufferInfo)}function iu(e){let{gl:t,framebuffers:r,state:n}=e;Je(t,r.landMap);let o=t.getParameter(t.IMPLEMENTATION_COLOR_READ_FORMAT),a=t.getParameter(t.IMPLEMENTATION_COLOR_READ_TYPE),l=Lt(e),s=[n.sailboatLocation[0]-l[0],n.sailboatLocation[1]-l[1]],i=Math.floor(((s[0]-It[1])/Me[0]*1+.5)*r.landMap.width),c=Math.ceil(((s[0]+It[0])/Me[0]*1+.5)*r.landMap.width),u=Math.floor(((s[1]+It[2])/Me[1]*-1+.5)*r.landMap.height),h=Math.ceil(((s[1]-It[3])/Me[1]*-1+.5)*r.landMap.height),m=Math.max(c-i+1,1),x=Math.max(h-u+1,1),f=4;e.sailboatAltitudes||(e.sailboatAltitudes=new Uint8Array(m*x*2*f)),t.readPixels(i,u,m,x,o,a,e.sailboatAltitudes);for(let p=0,_=m*x*f;p<_;p+=f)if(e.sailboatAltitudes[p]>$l)return!0;return!1}function Lt(e){return[0,-he*(e.state.level+(Ct*.5-.5))]}function Pt(e,t){e.state.directionPresseds[t]||(e.state.sailing=t,e.state.directionPresseds[t]=!0,ea(e))}function Bt(e,t){e.state.directionPresseds[t]=!1,e.state.directionPresseds.left?e.state.sailing="left":e.state.directionPresseds.right?e.state.sailing="right":e.state.sailing=!1,ea(e)}function ea(e){e.state.sailing==="left"?(document.getElementById("sail-left").classList.add("active"),document.getElementById("sail-right").classList.remove("active")):e.state.sailing==="right"?(document.getElementById("sail-left").classList.remove("active"),document.getElementById("sail-right").classList.add("active")):(document.getElementById("sail-left").classList.remove("active"),document.getElementById("sail-right").classList.remove("active"))}function su(e){e.state={fieldOfView:$(45),cameraRotationXY:[$(-15),$(135)],cameraDistance:15,cameraViewing:[0,0,0],lightRotationXY:[$(20),$(-60)],resolutionRatio:1,seed:Math.random()*2e4+5e3,started:!1,gameOver:!1,startedTime:0,level:0,windStrength:.1,directionPresseds:{left:!1,right:!1},sailing:!1,sailTranslateY:0,sailScaleX:1,sailScaleY:1,sailFrontScaleXY:1,sailboatRotationX:$(0),sailboatTranslateY:0,sailboatLocation:[0,0],sailboatVelocity:[0,0]},Jo(e);let t=document.getElementById("sail-left"),r=document.getElementById("sail-right");[[t,"left"],[r,"right"]].forEach(([n,o])=>{n.addEventListener("contextmenu",a=>{a.preventDefault()}),n.addEventListener("touchstart",()=>{Pt(e,o)}),n.addEventListener("touchend",()=>{Bt(e,o)}),n.addEventListener("mousedown",()=>{Pt(e,o)}),n.addEventListener("mouseup",()=>{Bt(e,o)})}),document.addEventListener("keydown",n=>{n.code==="KeyA"||n.code==="ArrowLeft"?Pt(e,"left"):(n.code==="KeyD"||n.code==="ArrowRight")&&Pt(e,"right")}),document.addEventListener("keyup",n=>{n.code==="KeyA"||n.code==="ArrowLeft"?Bt(e,"left"):(n.code==="KeyD"||n.code==="ArrowRight")&&Bt(e,"right")}),document.getElementById("refresh").addEventListener("click",()=>{window.location.reload()})}function cu(e,t,r){let{state:n}=e;if(n.started)if(n.gameOver)n.sailboatRotationX=Math.min(n.sailboatRotationX+t*5e-5,$(60)),n.sailboatTranslateY=Math.max(n.sailboatTranslateY-t*5e-5,-1);else{if(n.cameraRotationXY[1]=Math.max(n.cameraRotationXY[1]-t*.0045,0),n.cameraDistance=Math.min(n.cameraDistance+t*.01,25),n.sailing){n.sailTranslateY=Math.max(n.sailTranslateY-t*.0045,0),n.sailScaleY=Math.min(n.sailScaleY+t*.0018,1),n.sailFrontScaleXY=Math.min(n.sailFrontScaleXY+t*.002,1);let a;n.sailing==="left"?(a=-Ho,n.sailScaleX=-1):n.sailing==="right"&&(a=Ho,n.sailScaleX=1),n.sailboatVelocity[0]+=n.windStrength*t*$o*Math.sin(a),n.sailboatVelocity[1]-=n.windStrength*t*$o*Math.cos(a)}else n.sailTranslateY=Math.min(n.sailTranslateY+t*.0045,2.25),n.sailScaleY=Math.max(n.sailScaleY-t*.0018,.1),n.sailFrontScaleXY=Math.max(n.sailFrontScaleXY-t*.002,0);let o=uu(n.sailboatVelocity,t);n.sailboatVelocity[0]*=o,n.sailboatVelocity[1]*=o,n.sailboatLocation[0]+=n.sailboatVelocity[0]*t,n.sailboatLocation[1]+=n.sailboatVelocity[1]*t,n.cameraViewing=[n.sailboatLocation[0],0,n.sailboatLocation[1]],fu(e),iu(e)?(n.gameOver=!0,n.score=Math.max(Math.floor(-n.sailboatLocation[1]-4*(e.time-n.startedTime)/1e3),0),lu(e)):n.sailboatLocation[1]<Lt(e)[1]&&(n.level++,n.windStrength=Math.min(n.windStrength+.005,.4),console.log("next level!",{level:n.level,windStrength:n.windStrength}),Jo(e))}else n.sailing&&(n.started=!0,n.startedTime=r)}function lu(e){e.input=cn(e.gl.canvas,e.state),document.getElementById("ui").classList.add("hidden"),document.getElementById("refresh").classList.remove("hidden");let t=ru(e);e.textures.text=Qo(gl,t)}function uu(e,t){let r=Math.sqrt(e[0]*e[0]+e[1]*e[1]);if(r>jo)return jo/r;let n=t*jl;return r<n?0:(r-n)/r}function fu(e){document.getElementById("status-distance").textContent=(-e.state.sailboatLocation[1]).toFixed(2),document.getElementById("status-time").textContent=`${((e.time-e.state.startedTime)/1e3).toFixed(1)} \u79D2`}function ta(e,t=0){let r=t-e.time;e.time=t,cu(e,r,t),au(e,r),requestAnimationFrame(n=>ta(e,n))}function mu(){return ve(this,null,function*(){let e=document.getElementById("loading");try{let t=yield Jl();window.app=t,window.gl=t.gl,su(t);let r=document.getElementById("resolution-ratio");if(r.addEventListener("change",()=>{t.state.resolutionRatio=parseFloat(r.value)}),window.devicePixelRatio>1){let n=document.getElementById("resolution-ratio-retina");n.value=window.devicePixelRatio,n.disabled=!1}e.remove(),ta(t)}catch(t){e.textContent=`Your browser might not be supported.
error: ${t.message}`}})}mu();})();
/* @license twgl.js 4.24.0 Copyright (c) 2015, Gregg Tavares All Rights Reserved.
Available via the MIT license.
see: http://github.com/greggman/twgl.js for details */
